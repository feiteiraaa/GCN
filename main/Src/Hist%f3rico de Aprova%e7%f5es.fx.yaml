"'Histórico de Aprovações' As screen":
    OnVisible: |-
        =ClearCollect(
            Estados,
            Blank(),
            Choices('Estado Processo')
        );
        
        UpdateContext({checkBox: false});
        
        ClearCollect(
            AtividadeFormMenu,
            Table(
            //Excel 02
                {
                    titulo: "Caracterização do Processo",
                    estado: "em curso",
                    modo: DisplayMode.Edit
                },
                {
                    titulo: "Fatores de Criticidade",
                    estado: "em falta",
                    modo: DisplayMode.Edit
                },
            //Excel 03
                {
                    titulo: "Caracterização dos Recursos",
                    estado: "em falta",
                    modo: DisplayMode.Disabled
                },
            //Excel 04
                {
                    titulo: "Caracterização dos Equipamentos",
                    estado: "em falta",
                    modo: DisplayMode.Disabled
                },
            //Excel 05
                {
                    titulo: "Caracterização dos Sistemas",
                    estado: "em falta",
                    modo: DisplayMode.Disabled
                },
            //Excel 06
                {
                    titulo: "Dependências",
                    estado: "em falta",
                    modo: DisplayMode.Disabled
                }
            )
        )

    "'Gallery Data_1' As gallery.variableTemplateHeightGallery":
        DelayItemLoading: =true
        DisplayMode: =DisplayMode.View
        Fill: =Color.White
        Height: =493
        Items: |-
            =With(
                {
                    records:
                    If(
                        IsBlank(recordId),
            
                        If(
                            currentUser = "DRI",
                            'Histórico de aprovações',
                            Filter(
                                'Histórico de aprovações',
                                ThisRecord.'ID Atividade'.'Unidade Orgânica' = currentUser
                            )
                        ),
            
                        Filter(
                            'Histórico de aprovações',
                            Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Trim(Lower(recordId))
                        )
                    )        
                },
                ForAll(
                    Sequence(CountRows(records)),
                    Patch(
                        Last(
                            FirstN(
                                SortByColumns(
                                    records,
                                    "createdon",
                                    SortOrder.Descending
                                ),
                                Value
                            )
                        ),
                        {rowNumber: Value}
                    )
                )
            )
            /*Filter(
                            'Histórico de aprovações',
                            Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Trim(Lower(recordId))
                        )*/
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        OnSelect: =
        ShowScrollbar: =false
        TemplateFill: |-
            =If(
                Mod(ThisItem.rowNumber, 2) = 0,
                Color.LightSlateGray,
                Color.White
            )
        TemplatePadding: =0
        TemplateSize: =75
        Width: =Principal_1.Width
        X: =Principal_1.X
        Y: =Principal_1.Y + Principal_1.Height
        ZIndex: =13

        Rectangle2_1 As rectangle:
            Fill: |-
                =Switch(
                    Trim(Lower(ThisItem.Estado)),
                    
                    Trim(Lower("Em preenchimento")),
                    Color.Blue,
                    
                    Trim(Lower("Em validação")),
                    Color.Yellow,
                
                    Trim(Lower("Aprovado")),
                    Color.Green,
                
                    Trim(Lower("Rejeitado")),
                    Color.Red,
                
                    Trim(Lower("Em revisão pela U.O.")),
                    Color.DarkOrange,
                
                    Trim(Lower("Em revalidação")),
                    Color.Yellow
                
                )
            Height: =75
            OnSelect: =Select(Parent)
            Width: =7
            ZIndex: =1

        "'U.O._1' As label":
            Align: =Align.Center
            Color: |-
                =If(
                    Mod(ThisItem.rowNumber, 2) = 0,
                    Color.White,
                    Color.DarkSlateGray
                )
            Height: =Rectangle2_1.Height
            OnSelect: |-
                =Select(Parent);
                Navigate('Atividade Form Screen',ScreenTransition.None, {formMode: FormMode.View, Criticidade: 0});
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =ThisItem.Estado
            Width: |-
                =(
                    Principal_1.Width - ('U.O. Header Split_1'.Width * 4)
                ) / 4
            Y: =Rectangle2_1.Y
            ZIndex: =2

        "'U.O. Split_1' As rectangle":
            Fill: =Color.LightGray
            Height: =Rectangle2_1.Height
            OnSelect: =
            Width: =2
            X: ='U.O._1'.X + 'U.O._1'.Width
            Y: =Rectangle2_1.Y
            ZIndex: =3

        Atividade_1 As label:
            Align: =Align.Center
            Color: |-
                =If(
                    Mod(ThisItem.rowNumber, 2) = 0,
                    Color.White,
                    Color.DarkSlateGray
                )
            Height: =Rectangle2_1.Height
            OnSelect: |-
                =Select(Parent);
                Navigate('Atividade Form Screen',ScreenTransition.None, {formMode: FormMode.View, Criticidade: 0});
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =ThisItem.'ID Atividade'.Atividade
            Width: |-
                =(
                    Principal_1.Width - ('U.O. Header Split_1'.Width * 4)
                ) / 4
            X: ='U.O. Split_1'.X + 'U.O. Split_1'.Width
            Y: =Rectangle2_1.Y
            ZIndex: =4

        "'Atividade Split_1' As rectangle":
            Fill: =Color.LightGray
            Height: =Rectangle2_1.Height
            OnSelect: =Atividade_1.X + Atividade_1.Width
            Width: =2
            X: =Atividade_1.X + Atividade_1.Width
            Y: =Rectangle2_1.Y
            ZIndex: =5

        Descricao_1 As label:
            Align: =Align.Center
            Color: |-
                =If(
                    Mod(ThisItem.rowNumber, 2) = 0,
                    Color.White,
                    Color.DarkSlateGray
                )
            Height: =Rectangle2_1.Height
            OnSelect: |-
                =Select(Parent);
                Navigate('Atividade Form Screen',ScreenTransition.None, {formMode: FormMode.View, Criticidade: 0});
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =ThisItem.'ID Atividade'.'Unidade Orgânica'
            Width: |-
                =(
                    Principal_1.Width - ('U.O. Header Split_1'.Width * 4)
                ) / 4
            X: ='Atividade Split_1'.X + 'Atividade Split_1'.Width
            Y: =Rectangle2_1.Y
            ZIndex: =6

        "'Descricao Split_1' As rectangle":
            Fill: =Color.LightGray
            Height: =Rectangle2_1.Height
            OnSelect: =
            Width: =2
            X: =Descricao_1.X + Descricao_1.Width
            Y: =Rectangle2_1.Y
            ZIndex: =7

        "'Tipo Processo_1' As label":
            Align: =Align.Center
            Color: |-
                =If(
                    Mod(ThisItem.rowNumber, 2) = 0,
                    Color.White,
                    Color.DarkSlateGray
                )
            Height: =Rectangle2_1.Height
            OnSelect: |-
                =Select(Parent);
                Navigate('Atividade Form Screen',ScreenTransition.None, {formMode: FormMode.View, Criticidade: 0});
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Text: =First(ThisItem.'ID Atividade'.RTOS).Classificação
            Width: |-
                =(
                    Principal_1.Width - ('U.O. Header Split_1'.Width * 4)
                ) / 4
            X: ='Descricao Split_1'.X + 'Descricao Split_1'.Width
            Y: =Rectangle2_1.Y
            ZIndex: =8

    Label1_4 As label:
        Size: =15
        Text: |-
            ="Histórico de Atividades"
            &
            If(
                !IsBlank(recordId),
                " - " & LookUp(
                    Atividades,
                    ThisRecord.ID = recordId
                ).Atividade
            )
        Width: =610
        X: =359
        Y: =27
        ZIndex: =22

    LeftSectionComponent_5 As LeftSectionComponent:
        ZIndex: =23

    "'Galery Headers_1' As group":
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =25

        Principal_1 As rectangle:
            Fill: =cores.cinzento
            Height: =63
            OnSelect: =
            TabIndex: =0
            Width: =990
            X: =358
            Y: =144
            ZIndex: =1

        "'U.O. Header_1' As label":
            Align: =Align.Center
            Color: =Color.LightGray
            Height: =Principal_1.Height
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            TabIndex: =0
            Text: ="Estado"
            Width: |-
                =(
                    Principal_1.Width - ('U.O. Header Split_1'.Width * 4)
                ) / 4
            X: =359
            Y: =144
            ZIndex: =2

        "'U.O. Header Split_1' As rectangle":
            Fill: =Color.LightGray
            Height: =Principal_1.Height
            OnSelect: =
            TabIndex: =0
            Width: =2
            X: =603
            Y: =144
            ZIndex: =3

        "'Atividade Header_1' As label":
            Align: =Align.Center
            Color: =Color.LightGray
            Height: =Principal_1.Height
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            TabIndex: =0
            Text: ="Atividade"
            Width: |-
                =(
                    Principal_1.Width - ('U.O. Header Split_1'.Width * 4)
                ) / 4
            X: =605
            Y: =144
            ZIndex: =4

        "'Atividade Header Split_1' As rectangle":
            Fill: =Color.LightGray
            Height: =Principal_1.Height
            OnSelect: =
            TabIndex: =0
            Width: =2
            X: =851
            Y: =144
            ZIndex: =5

        "'Descricao Header_1' As label":
            Align: =Align.Center
            Color: =Color.LightGray
            Height: =Principal_1.Height
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            TabIndex: =0
            Text: ="Unidade Orgânica"
            Width: |-
                =(
                    Principal_1.Width - ('U.O. Header Split_1'.Width * 4)
                ) / 4
            X: =849
            Y: =144
            ZIndex: =6

        "'Descricao Header Split_1' As rectangle":
            Fill: =Color.LightGray
            Height: =Principal_1.Height
            OnSelect: =
            TabIndex: =0
            Width: =2
            X: =1098
            Y: =144
            ZIndex: =7

        "'Tipo Processo Header_1' As label":
            Align: =Align.Center
            Color: =Color.LightGray
            Height: =Principal_1.Height
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            TabIndex: =0
            Text: ="Classificação de RTO"
            Width: |-
                =(
                    Principal_1.Width - ('U.O. Header Split_1'.Width * 4)
                ) / 4
            X: =1102
            Y: =144
            ZIndex: =8

    NovaAtividade_2 As group:
        Height: =5
        Width: =5
        X: =20
        Y: =20
        ZIndex: =26

        DynamicBtn_3 As DynamicBtn:
            BtnText: ="Ecrã anterior"
            BtnWidth: =200
            ButtonIcon: =Icon.BackArrow
            X: =1110
            Y: =32
            ZIndex: =24

        Button2_2 As button:
            BorderColor: =Color.Transparent
            Color: =Color.Transparent
            Fill: =Color.Transparent
            Height: =DynamicBtn_3.Height
            HoverColor: =Color.Transparent
            HoverFill: =Color.Transparent
            OnSelect: =Back()
            PressedColor: =Color.Transparent
            Text: =
            Visible: =currentUser = "DRI"
            Width: =DynamicBtn_3.Width
            X: =1110
            Y: =DynamicBtn_3.Y
            ZIndex: =25


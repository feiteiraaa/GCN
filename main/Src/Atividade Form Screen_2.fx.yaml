"'Atividade Form Screen_2' As screen":
    OnVisible: |-
        =UpdateContext({
            ModalForm: {visible: false, text: "Deseja submeter os dados da Atividade?"}
        });
        
        UpdateContext({
            ApproveForm: { visible: false, texto: ""}
        });
        
        If(
            formMode <> FormMode.New,
        
            UpdateContext({
                AtividadeRecord: LookUp(
                    Atividades,
                    ThisRecord.ID = 'Gallery Data'.Selected.ID
                )
            });
            UpdateIf(
                AtividadeFormMenu,
                ThisRecord.modo = DisplayMode.Disabled,
                {modo: DisplayMode.Edit}
            );
            UpdateIf(
                AtividadeFormMenu,
                Lower(Trim(ThisRecord.titulo)) = Lower(Trim("Fatores de Criticidade")),
                {estado : "feito"}
            );
            // dados dos Recursos/Pessoas
        Clear(collectRecursos);
        
            ForAll(
                Filter(
                    Pessoas,
                    ThisRecord.'ID Atividade'.ID = Text('Gallery Data'.Selected.ID)
                ),
                Collect(
                    collectRecursos,
                    {
                        row: Last(collectRecursos).row + 1,
                        ID: ThisRecord.ID,
                        Colaborador: ThisRecord.'Colaborador Crítico',
                        Duracao: ThisRecord.Duração,
                        NumEmpregado: ThisRecord.'Nº Empregado',
                        Teletrabalho: ThisRecord.Teletrabalho,
                        Tipo: ThisRecord.Tipo.Tipo,
                        Observações: ThisRecord.Observações
                    }
                )
            );
            // dados dos Equipamentos
        
        Clear(collectEquipamentos);
            ForAll(
                Filter(
                    'Equipamentos de Escritório',
                    ThisRecord.'ID Atividade'.ID = Text('Gallery Data'.Selected.ID)
                ),
                Collect(
                    collectEquipamentos,
                    {
                        row: Last(collectEquipamentos).row + 1,
                        ID: ThisRecord.ID,
                        Equipamento: ThisRecord.Equipamento,
                        Duracao: ThisRecord.Duração,
                        Observações: ThisRecord.Observações
                    }
                )
            );
            // dados dos Sistemas/Aplicações
        
        Clear(collectSistemas);
        
            ForAll(
                Filter(
                    Sistemas,
                    ThisRecord.'ID Atividade'.ID = Text('Gallery Data'.Selected.ID)
                ),
                Collect(
                    collectSistemas,
                    {
                        row: Last(collectSistemas).row + 1,
                        ID: ThisRecord.ID,
                        Sistema: ThisRecord.'Sistemas/Aplicações',
                        Duracao: ThisRecord.Duração,
                        Descricao: ThisRecord.Descrição,
                        Observações: ThisRecord.Observações
                    }
                )
            );
            // dados das Dependências
        Clear(collectDependencias);
        
            ForAll(
                Filter(
                    Dependências,
                    ThisRecord.'ID Atividade'.ID = Text('Gallery Data'.Selected.ID)
                ),
                Collect(
                    collectDependencias,
                    {
                        row: Last(collectDependencias).row + 1,
                        ID: ThisRecord.ID,
                        Entidade: ThisRecord.Entidades,
                        Tipo: ThisRecord.'Tipo de Dependência',
                        Importancia: ThisRecord.Importância,
                        Informacao: ThisRecord.'Informação de Suporte',
                        Unidade: ThisRecord.'Unidade Orgânica',
                        Observações: ThisRecord.Observações
                    }
                )
            )
        );
        ClearCollect(ColAtividades,Filter('Atividade/Processos',ID_PRO.ID='Gallery Data_6'.Selected.ID));

    Label7_5 As label:
        Align: =Align.Center
        Color: =cores.cinzento
        Text: ="Adição de " & 'Passos do Registo de Atividade_2'.Selected.titulo & " apenas disponível quando Fatores de Criticidade com valor igual a 4."
        Visible: |-
            =Switch(
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)),
                
                Trim(Lower("Caracterização dos Recursos")),
                If(CountRows(collectRecursos) = 0, true, false),
            
                Trim(Lower("Caracterização dos Equipamentos")),
                If(CountRows(collectEquipamentos) = 0, true, false),
            
                Trim(Lower("Caracterização dos Sistemas")),
                If(CountRows(collectSistemas) = 0, true, false),
            
                Trim(Lower("Dependências")),
                If(CountRows(collectDependencias) = 0, true, false)
            )
            And
            If(formMode = FormMode.New, true, false)
            And
            If(
                Value('4Horas_2'.Text) =4 Or
                Value('24Horas_2'.Text)= 4 Or
                Value('48Horas_2'.Text) = 4 Or
                Value('1Semana_2'.Text) = 4 Or
                Value('2Semanas_2'.Text) = 4 Or
                Value('1Mes_2'.Text) = 4, false, true
            )
        Width: =980
        X: =360
        Y: =220
        ZIndex: =1

    LeftSectionComponent_11 As LeftSectionComponent:
        ZIndex: =2

    "'Caracterizacao do Processo_2' As form":
        DataSource: =Atividades
        DefaultMode: |-
            =Switch(
                formMode,
                0,
                FormMode.Edit,
                1,
                FormMode.New,
                FormMode.View
            )
        Height: =385
        Item: |-
            =If(
                formMode = FormMode.New,
                Blank(),
                LookUp(
                    Atividades,
                    ThisRecord.ID = 'Gallery Data'.Selected.ID
                )
            )
        Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo"))
        Width: =990
        X: =360
        Y: =175
        ZIndex: =3

        ID_Total_DataCard1 As typedDataCard.textualEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="uipp_id_total"
            Default: =ThisItem.ID_Total
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Atividades],DataSourceInfo.DisplayName,"uipp_id_total")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            MaxLength: =DataSourceInfo([@Atividades], DataSourceInfo.MaxLength, "uipp_id_total")
            Required: =false
            Update: =dcv_idtotal.Text
            Width: =330
            X: =0
            Y: =0
            ZIndex: =1

            DataCardKey1 As label:
                AutoHeight: =true
                Color: =RGBA(0, 0, 0, 1)
                FontWeight: =FontWeight.Bold
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            dcv_idtotal As text:
                BorderColor: =Color.Black
                BorderThickness: =0
                Default: =LookUp('Tipo Processos','Tipo de Processo'=DataCardValue11_2.Selected.'Tipo de Processo',ID_Tipo_Processo) &"-" & LookUp('Macro Processos','Macro Processo (uipp_macroprocesso)'=DataCardValue8_2.Selected.'Macro Processo (uipp_macroprocesso)',ID_Macro_Processo) &"-" & Left(DataCardValue10_2.Selected.'Processo (uipp_processo)', 4)
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                MaxLength: =Parent.MaxLength
                PaddingLeft: =5
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey1.Y + DataCardKey1.Height + 5
                ZIndex: =2

            ErrorMessage2 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =dcv_idtotal.Y + dcv_idtotal.Height
                ZIndex: =3

            StarVisible2 As label:
                Align: =Align.Center
                Height: =DataCardKey1.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey1.Y
                ZIndex: =4

        "'Tipo de Processo_DataCard1_2' As typedDataCard.comboBoxEditCard":
            BorderStyle: =BorderStyle.Solid
            DataField: ="uipp_TipodeProcesso"
            Default: =ThisItem.'Tipo de Processo'
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Atividades],DataSourceInfo.DisplayName,"uipp_TipodeProcesso")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =110
            Required: =true
            Update: =DataCardValue11_2.Selected
            Width: =329
            X: =0
            Y: =1
            ZIndex: =1

            DataCardKey12_2 As label:
                AutoHeight: =true
                Color: =cores.cinzento
                FontWeight: =FontWeight.Bold
                Height: =34
                Text: =Parent.DisplayName
                Width: =294
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue11_2 As combobox:
                BorderColor: =If(IsBlank(Parent.Error), cores.cinzento, Color.Red)
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =cores.amareloMontepio
                DefaultSelectedItems: =Parent.Default
                DisplayFields: =["uipp_tipodeprocesso"]
                DisplayMode: =Parent.DisplayMode
                HoverBorderColor: =cores.cinzento
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: ="Tipo de Processo"
                Items: =Choices([@Atividades].'Tipo de Processo')
                OnChange: |-
                    =If(
                        !IsBlank(DataCardValue11_2.Selected) And !IsBlank(DataCardValue8_2.Selected) And !IsBlank(DataCardValue10_2.Selected),
                        Patch(
                            AtividadeFormMenu,
                            LookUp(
                                AtividadeFormMenu,
                                Trim(Lower(ThisRecord.titulo)) = Trim(Lower("Caracterização do Processo"))
                            ),
                            {
                                estado: "feito"
                            }
                        )
                    )
                PaddingLeft: |-
                    =//If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                    5
                PressedFill: =cores.amareloMontepio
                SearchFields: =["uipp_tipodeprocesso"]
                SearchItems: =Search(Choices([@Atividades].'Tipo de Processo'),DataCardValue11_2.SearchText,"uipp_tipodeprocesso")
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =Parent.DisplayName
                Width: =280
                X: =30
                Y: =44
                ZIndex: =2

            ErrorMessage10_2 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue11_2.Y + DataCardValue11_2.Height
                ZIndex: =3

            StarVisible10_4 As label:
                Align: =Align.Center
                Color: =Color.Red
                Height: =DataCardKey12_2.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey12_2.Y
                ZIndex: =4

        "'Macro Processo_DataCard1_2' As typedDataCard.comboBoxEditCard":
            BorderStyle: =BorderStyle.Solid
            DataField: ="uipp_MacroProcesso"
            Default: =ThisItem.'Macro Processo'
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Atividades],DataSourceInfo.DisplayName,"uipp_MacroProcesso")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =true
            Update: =DataCardValue8_2.Selected
            Visible: =true
            Width: =329
            X: =1
            Y: =1
            ZIndex: =1

            DataCardKey9_2 As label:
                AutoHeight: =true
                Color: =cores.cinzento
                FontWeight: =FontWeight.Bold
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue8_2 As combobox:
                BorderColor: =If(IsBlank(Parent.Error), cores.cinzento, Color.Red)
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =cores.amareloMontepio
                DefaultSelectedItems: =Parent.Default
                DisplayFields: =["uipp_macroprocesso"]
                DisplayMode: =Parent.DisplayMode
                HoverBorderColor: =cores.cinzento
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: ="Macro Processo"
                Items: =Choices([@Atividades].'Macro Processo')
                OnChange: |-
                    =If(
                        !IsBlank(DataCardValue11_2.Selected) And !IsBlank(DataCardValue8_2.Selected) And !IsBlank(DataCardValue10_2.Selected),
                        Patch(
                            AtividadeFormMenu,
                            LookUp(
                                AtividadeFormMenu,
                                Trim(Lower(ThisRecord.titulo)) = Trim(Lower("Caracterização do Processo"))
                            ),
                            {
                                estado: "feito"
                            }
                        )
                    )
                PressedFill: =cores.amareloMontepio
                SearchFields: =["uipp_macroprocesso"]
                SearchItems: =Search(Choices([@Atividades].'Macro Processo'),DataCardValue8_2.SearchText,"uipp_macroprocesso")
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =44
                ZIndex: =2

            ErrorMessage7_2 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue8_2.Y + DataCardValue8_2.Height
                ZIndex: =3

            StarVisible7_2 As label:
                Align: =Align.Center
                Color: =Color.Red
                Height: =DataCardKey9_2.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey9_2.Y
                ZIndex: =4

        Processo_DataCard1_2 As typedDataCard.comboBoxEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="uipp_Processo"
            Default: =ThisItem.Processo
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Atividades],DataSourceInfo.DisplayName,"uipp_Processo")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =true
            Update: =DataCardValue10_2.Selected
            Width: =329
            X: =2
            Y: =1
            ZIndex: =1

            DataCardKey11_2 As label:
                AutoHeight: =true
                Color: =cores.cinzento
                FontWeight: =FontWeight.Bold
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue10_2 As combobox:
                BorderColor: =If(IsBlank(Parent.Error), cores.cinzento, Color.Red)
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =cores.amareloMontepio
                DefaultSelectedItems: =Parent.Default
                DisplayFields: =["uipp_processo"]
                DisplayMode: =Parent.DisplayMode
                HoverBorderColor: =cores.cinzento
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: ="Processo"
                Items: =Choices([@Atividades].Processo)
                OnChange: |-
                    =If(
                        !IsBlank(DataCardValue11_2.Selected) And !IsBlank(DataCardValue8_2.Selected) And !IsBlank(DataCardValue10_2.Selected),
                        Patch(
                            AtividadeFormMenu,
                            LookUp(
                                AtividadeFormMenu,
                                Trim(Lower(ThisRecord.titulo)) = Trim(Lower("Caracterização do Processo"))
                            ),
                            {
                                estado: "feito"
                            }
                        )
                    )
                PressedFill: =cores.amareloMontepio
                SearchFields: =["uipp_processo"]
                SearchItems: =Search(Choices([@Atividades].Processo),DataCardValue10_2.SearchText,"uipp_processo")
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =44
                ZIndex: =2

            ErrorMessage9_2 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue10_2.Y + DataCardValue10_2.Height
                ZIndex: =3

            StarVisible9_2 As label:
                Align: =Align.Center
                Color: =Color.Red
                Height: =DataCardKey11_2.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey11_2.Y
                ZIndex: =4

        Estado_DataCard1_2 As typedDataCard.comboBoxOptionSetSingleEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="uipp_estado"
            Default: =ThisItem.Estado
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Atividades],DataSourceInfo.DisplayName,"uipp_estado")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =false
            Update: =DataCardValue6_2.Selected.Value
            Visible: =false
            Width: =329
            X: =1
            Y: =1
            ZIndex: =1

            DataCardKey7_2 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                ZIndex: =1

            DataCardValue6_2 As combobox:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                Default: |-
                    =LookUp(
                        Choices('Estado Processo'),
                        Text(ThisRecord.Value) = "Em preenchimento"
                    )
                DefaultSelectedItems: |-
                    =/*If(
                        IsBlank([Parent.Default]),
                        */LookUp(
                            Choices('Estado Processo'),
                            Text(ThisRecord.Value) = "Em preenchimento"
                        )/*,
                        [Parent.Default]
                    )*/
                DisplayFields: =["Value"]
                DisplayMode: =Parent.DisplayMode
                IsSearchable: =false
                Items: =Choices('Estado Processo')
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                SearchFields: =["Value"]
                SearchItems: =[]
                SelectMultiple: =false
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                Y: =21
                ZIndex: =2

            ErrorMessage5_2 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue6_2.Y + DataCardValue6_2.Height
                ZIndex: =3

            StarVisible5_2 As label:
                Align: =Align.Center
                Height: =DataCardKey7_2.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey7_2.Y
                ZIndex: =4

        Edifício_DataCard1_2 As typedDataCard.comboBoxEditCard:
            BorderStyle: =BorderStyle.Solid
            DataField: ="uipp_Edificio"
            Default: =ThisItem.Edifício
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Atividades],DataSourceInfo.DisplayName,"uipp_Edificio")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            Required: =false
            Update: =DataCardValue7_2.Selected
            Width: =329
            X: =0
            Y: =3
            ZIndex: =1

            DataCardKey8_2 As label:
                AutoHeight: =true
                Color: =cores.cinzento
                FontWeight: =FontWeight.Bold
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue7_2 As combobox:
                BorderColor: =If(IsBlank(Parent.Error), cores.cinzento, Color.Red)
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =cores.amareloMontepio
                DefaultSelectedItems: =Parent.Default
                DisplayFields: =["uipp_localizacao"]
                DisplayMode: =Parent.DisplayMode
                HoverBorderColor: =cores.cinzento
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: ="Edifício"
                Items: =Choices([@Atividades].Edifício)
                PressedFill: =cores.amareloMontepio
                SearchFields: =["uipp_localizacao"]
                SearchItems: =Search(Choices([@Atividades].Edifício),DataCardValue7_2.SearchText,"uipp_localizacao")
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =Parent.DisplayName
                Width: =280
                X: =30
                Y: =49
                ZIndex: =2

            ErrorMessage6_2 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue7_2.Y + DataCardValue7_2.Height
                ZIndex: =3

            StarVisible6_2 As label:
                Align: =Align.Center
                Height: =DataCardKey8_2.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey8_2.Y
                ZIndex: =4

        "'Unidade Orgânica_DataCard1_2' As typedDataCard.textualEditCard":
            BorderStyle: =BorderStyle.Solid
            DataField: ="uipp_unidadeorganica"
            Default: =ThisItem.'Unidade Orgânica'
            DisplayMode: =Parent.DisplayMode
            DisplayName: =DataSourceInfo([@Atividades],DataSourceInfo.DisplayName,"uipp_unidadeorganica")
            Fill: =RGBA(0, 0, 0, 0)
            Height: =50
            MaxLength: =DataSourceInfo([@Atividades], DataSourceInfo.MaxLength, "uipp_unidadeorganica")
            Required: =false
            Update: =DataCardValue12_2.Text
            Visible: =false
            Width: =329
            X: =2
            Y: =1
            ZIndex: =1

            DataCardKey13_2 As label:
                AutoHeight: =true
                Height: =34
                Text: =Parent.DisplayName
                Width: =Parent.Width - 60
                Wrap: =false
                X: =30
                Y: =10
                ZIndex: =1

            DataCardValue12_2 As text:
                BorderColor: =If(IsBlank(Parent.Error), Parent.BorderColor, Color.Red)
                Default: |-
                    =If(
                        IsBlank(Parent.Default),
                        currentUser,
                        Parent.Default
                    )
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                MaxLength: =Parent.MaxLength
                PaddingLeft: =5
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =Parent.DisplayName
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardKey13_2.Y + DataCardKey13_2.Height + 5
                ZIndex: =2

            ErrorMessage11_2 As label:
                AutoHeight: =true
                Height: =10
                Live: =Live.Assertive
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                Text: =Parent.Error
                Visible: =Parent.DisplayMode=DisplayMode.Edit
                Width: =Parent.Width - 60
                X: =30
                Y: =DataCardValue12_2.Y + DataCardValue12_2.Height
                ZIndex: =3

            StarVisible11_2 As label:
                Align: =Align.Center
                Height: =DataCardKey13_2.Height
                Text: ="*"
                Visible: =And(Parent.Required, Parent.DisplayMode=DisplayMode.Edit)
                Width: =30
                Wrap: =false
                Y: =DataCardKey13_2.Y
                ZIndex: =4

    "Gallery2_2 As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
        DelayItemLoading: =true
        DisplayMode: |-
            =Switch(
                formMode,
                0,
                DisplayMode.Edit,
                1,
                DisplayMode.Edit,
                DisplayMode.View
            )
        Height: =480
        Items: =Choices('Tipo de Fator')
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplatePadding: =0
        TemplateSize: =96
        Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
        Width: =990
        X: =360
        Y: =199
        ZIndex: =10

        Separator2_2 As rectangle:
            Height: =8
            OnSelect: =Select(Parent)
            Width: =Parent.TemplateWidth
            Y: =Parent.TemplateHeight - Self.Height
            ZIndex: =5

        Label5_2 As label:
            FontWeight: =FontWeight.Semibold
            Height: =50
            OnSelect: =Select(Parent)
            Text: =ThisItem.Value
            Width: =130
            Y: =5
            ZIndex: =6

        "'4horas_2' As text":
            Align: =Align.Center
            BorderColor: =cores.cinzento
            Default: |-
                =If(
                    formMode = FormMode.New,
                    Criticidade,
                    Value(
                        LookUp(
                            'Fatores de Criticidades',
                            Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                            And
                            Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                        ).'quatro horas'
                    )
                )
            DelayOutput: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0,
                    DisplayMode.Edit,
                    1,
                    DisplayMode.Edit,
                    DisplayMode.View
                )
            Format: =TextFormat.Number
            HoverBorderColor: =cores.cinzento
            HoverFill: =
            MaxLength: =1
            OnChange: |-
                =Select('Calculate RTO_2');
                
                If(
                    Value(Self.Text) > 0,
                    
                    Patch(
                        AtividadeFormMenu,
                        LookUp(
                            AtividadeFormMenu,
                            Trim(Lower(ThisRecord.titulo)) = Trim(Lower("Fatores de Criticidade"))
                        ),
                        {
                            estado: "feito"
                        }
                    ),
                    
                    Patch(
                        AtividadeFormMenu,
                        LookUp(
                            AtividadeFormMenu,
                            Trim(Lower(ThisRecord.titulo)) = Trim(Lower("Fatores de Criticidade"))
                        ),
                        {
                            estado: "em curso"
                        }
                    )
                )
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Reset: =true
            Tooltip: =
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =50
            X: =106
            Y: =10
            ZIndex: =7

        "'24horas_2' As text":
            Align: =Align.Center
            BorderColor: =cores.cinzento
            Default: |-
                =If(
                    formMode = FormMode.New,
                    If(
                        IsBlank('4horas_2'.Text)
                        Or
                        Value('4horas_2'.Text) = 0,
                        ""
                    ),
                    If(
                        formMode = FormMode.View,
                        Value(
                            LookUp(
                                'Fatores de Criticidades',
                                Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                And
                                Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                            ).'vinte quatro horas'
                        ),
                        If(
                            IsBlank(
                                LookUp(
                                    'Fatores de Criticidades',
                                    Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                    And
                                    Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                                ).'vinte quatro horas'
                            ),
                            "",
                            LookUp(
                                'Fatores de Criticidades',
                                Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                And
                                Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                            ).'vinte quatro horas'
                        )
                    )
                )
            DelayOutput: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0, //Edit
                    If(
                        IsBlank('4horas_2'.Text) Or Value('4horas_2'.Text) = 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    ),
                    1, //New
                    If(
                        IsBlank('4horas_2'.Text) Or Value('4horas_2'.Text) = 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    ),
                    DisplayMode.View
                )
            Format: =TextFormat.Number
            HoverBorderColor: =cores.cinzento
            HoverFill: =
            MaxLength: =1
            Mode: =TextFormat.Number
            OnChange: =Select('Calculate RTO_2')
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Reset: =true
            Tooltip: =
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =50
            X: =216
            Y: =10
            ZIndex: =8

        "'48horas_2' As text":
            Align: =Align.Center
            BorderColor: =cores.cinzento
            Default: |-
                =If(
                    formMode = FormMode.New,
                    If(
                        IsBlank('24horas_2'.Text)
                        Or
                        Value('24horas_2'.Text) = 0,
                        ""
                    ),
                    If(
                        formMode = FormMode.View,
                        Value(
                            LookUp(
                                'Fatores de Criticidades',
                                Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                And
                                Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                            ).'quarenta oito horas'
                        ),
                        If(
                            IsBlank(
                                LookUp(
                                    'Fatores de Criticidades',
                                    Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                    And
                                    Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                                ).'quarenta oito horas'
                            ),
                            "",
                            LookUp(
                                'Fatores de Criticidades',
                                Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                And
                                Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                            ).'quarenta oito horas'
                        )
                    )
                )
            DelayOutput: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0, //Edit
                    If(
                        IsBlank('24horas_2'.Text) Or Value('24horas_2'.Text) = 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    ),
                    1, //New
                    If(
                        IsBlank('24horas_2'.Text) Or Value('24horas_2'.Text) = 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    ),
                    DisplayMode.View
                )
            Format: =TextFormat.Number
            HoverBorderColor: =cores.cinzento
            HoverFill: =
            MaxLength: =1
            Mode: =TextFormat.Number
            OnChange: =Select('Calculate RTO_2')
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Reset: =true
            Tooltip: =
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =50
            X: =326
            Y: =10
            ZIndex: =9

        "'1semana_2' As text":
            Align: =Align.Center
            BorderColor: =cores.cinzento
            Default: |-
                =If(
                    formMode = FormMode.New,
                    If(
                        IsBlank('48horas_2'.Text)
                        Or
                        Value('48horas_2'.Text) = 0,
                        ""
                    ),
                    If(
                        formMode = FormMode.View,
                        Value(
                            LookUp(
                                'Fatores de Criticidades',
                                Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                And
                                Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                            ).'uma semana'
                        ),
                        If(
                            IsBlank(
                                LookUp(
                                    'Fatores de Criticidades',
                                    Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                    And
                                    Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                                ).'uma semana'
                            ),
                            "",
                            LookUp(
                                'Fatores de Criticidades',
                                Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                And
                                Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                            ).'uma semana'
                        )
                    )
                )
            DelayOutput: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0, //Edit
                    If(
                        IsBlank('48horas_2'.Text) Or Value('48horas_2'.Text) = 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    ),
                    1, //New
                    If(
                        IsBlank('48horas_2'.Text) Or Value('48horas_2'.Text) = 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    ),
                    DisplayMode.View
                )
            Format: =TextFormat.Number
            HoverBorderColor: =cores.cinzento
            HoverFill: =
            MaxLength: =1
            Mode: =TextFormat.Number
            OnChange: =Select('Calculate RTO_2')
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Reset: =true
            Tooltip: =
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =50
            X: =436
            Y: =10
            ZIndex: =10

        "'2semanas_2' As text":
            Align: =Align.Center
            BorderColor: =cores.cinzento
            Default: |-
                =If(
                    formMode = FormMode.New,
                    If(
                        IsBlank('1semana_2'.Text)
                        Or
                        Value('1semana_2'.Text) = 0,
                        ""
                    ),
                    If(
                        formMode = FormMode.View,
                        Value(
                            LookUp(
                                'Fatores de Criticidades',
                                Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                And
                                Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                            ).'duas semanas'
                        ),
                        If(
                            IsBlank(
                                LookUp(
                                    'Fatores de Criticidades',
                                    Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                    And
                                    Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                                ).'duas semanas'
                            ),
                            "",
                            LookUp(
                                'Fatores de Criticidades',
                                Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                And
                                Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                            ).'duas semanas'
                        )
                    )
                )
            DelayOutput: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0, //Edit
                    If(
                        IsBlank('1semana_2'.Text) Or Value('1semana_2'.Text) = 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    ),
                    1, //New
                    If(
                        IsBlank('1semana_2'.Text) Or Value('1semana_2'.Text) = 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    ),
                    DisplayMode.View
                )
            Format: =TextFormat.Number
            HoverBorderColor: =cores.cinzento
            HoverFill: =
            MaxLength: =1
            Mode: =TextFormat.Number
            OnChange: =Select('Calculate RTO_2')
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Reset: =true
            Tooltip: =
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =50
            X: =546
            Y: =10
            ZIndex: =11

        "'1mes_2' As text":
            Align: =Align.Center
            BorderColor: =cores.cinzento
            Default: |-
                =If(
                    formMode = FormMode.New,
                    If(
                        IsBlank('2semanas_2'.Text)
                        Or
                        Value('2semanas_2'.Text) = 0,
                        ""
                    ),
                    If(
                        formMode = FormMode.View,
                        Value(
                            LookUp(
                                'Fatores de Criticidades',
                                Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                And
                                Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                            ).'um mes'
                        ),
                        If(
                            IsBlank(
                                LookUp(
                                    'Fatores de Criticidades',
                                    Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                    And
                                    Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                                ).'um mes'
                            ),
                            "",
                            LookUp(
                                'Fatores de Criticidades',
                                Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                                And
                                Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                            ).'um mes'
                        )
                    )
                )
            DelayOutput: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0, //Edit
                    If(
                        IsBlank('2semanas_2'.Text) Or Value('2semanas_2'.Text) = 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    ),
                    1, //New
                    If(
                        IsBlank('2semanas_2'.Text) Or Value('2semanas_2'.Text) = 0,
                        DisplayMode.Disabled,
                        DisplayMode.Edit
                    ),
                    DisplayMode.View
                )
            Format: =TextFormat.Number
            HoverBorderColor: =cores.cinzento
            HoverFill: =
            MaxLength: =1
            Mode: =TextFormat.Number
            OnChange: =Select('Calculate RTO_2')
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Reset: =true
            Tooltip: =
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =50
            X: =656
            Y: =10
            ZIndex: =12

        racional_2 As text:
            BorderColor: =cores.cinzento
            Default: |-
                =If(
                    formMode = FormMode.New,
                    "",
                    Value(
                        LookUp(
                            'Fatores de Criticidades',
                            Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                            And
                            Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                        ).Racional
                    )
                )
            DelayOutput: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0,
                    DisplayMode.Edit,
                    1,
                    DisplayMode.Edit,
                    DisplayMode.View
                )
            Height: =81
            HoverBorderColor: =cores.cinzento
            HoverFill: =
            MaxLength: =255
            Mode: =TextMode.MultiLine
            PaddingLeft: =5
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Tooltip: =
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =218
            X: =759
            Y: =10
            ZIndex: =13

        StarVisible10_5 As label:
            Align: =Align.Center
            Color: =Color.Red
            Height: =DataCardKey12_2.Height
            Text: ="*"
            Visible: |-
                =If(
                    Gallery2_2.DisplayMode = DisplayMode.Edit,
                    true,
                    false
                )
            Width: =25
            Wrap: =false
            X: =156
            ZIndex: =14

        Dropdown2_2 As dropdown:
            Default: |-
                =LookUp(
                    Choices('Tipo de Fator'),
                    ThisRecord.Value = ThisItem.Value
                ).Value
            Items: =Choices('Tipo de Fator')
            OnSelect: =Select(Parent)
            Visible: =false
            X: =31
            Y: =56
            ZIndex: =15

        Label3_2 As label:
            OnSelect: =Select(Parent)
            Text: |-
                =If(
                    formMode <> FormMode.New,
                    Value(
                        LookUp(
                            'Fatores de Criticidades',
                            Trim(Lower(ThisRecord.'ID Atividade'.ID)) = Text('Gallery Data'.Selected.ID)
                            And
                            Trim(Lower(ThisRecord.'Tipo de Fator')) = Trim(Lower(ThisItem.Value))
                        ).ID
                    )
                )
            Visible: =false
            X: =288
            Y: =56
            ZIndex: =16

    Label3_25 As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Semibold
        Text: ="Racional"
        Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
        Width: =110
        X: =1171
        Y: =160
        ZIndex: =11

    RTO_2 As groupContainer.manualLayoutContainer:
        Height: =80
        Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
        Width: =723
        X: =360
        Y: =655
        ZIndex: =12

        Global_2 As label:
            Fill: |-
                =//RGBA(0, 0, 0, 0)
                ColorFade(cores.amareloMontepio, 0.5)
            FontWeight: =FontWeight.Semibold
            Text: ="Global"
            Width: =734
            ZIndex: =1

        "'4Horas_2' As label":
            Align: =Align.Center
            FontWeight: =FontWeight.Bold
            Size: =14
            Text: |-
                =Max(
                    Gallery2_2.AllItems,
                    ThisRecord.'4horas_2'.Text
                )
            Width: =75
            X: =92
            ZIndex: =2

        "'24Horas_2' As label":
            Align: =Align.Center
            FontWeight: =FontWeight.Bold
            Size: =14
            Text: |-
                =Max(
                    Gallery2_2.AllItems,
                    ThisRecord.'24horas_2'.Text
                )
            Width: =75
            X: =202
            ZIndex: =3

        "'48Horas_2' As label":
            Align: =Align.Center
            FontWeight: =FontWeight.Bold
            Size: =14
            Text: |-
                =Max(
                    Gallery2_2.AllItems,
                    ThisRecord.'48horas_2'.Text
                )
            Width: =75
            X: =312
            ZIndex: =4

        "'1Semana_2' As label":
            Align: =Align.Center
            FontWeight: =FontWeight.Bold
            Size: =14
            Text: |-
                =Max(
                    Gallery2_2.AllItems,
                    ThisRecord.'1semana_2'.Text
                )
            Width: =75
            X: =422
            ZIndex: =5

        "'2Semanas_2' As label":
            Align: =Align.Center
            FontWeight: =FontWeight.Bold
            Size: =14
            Text: |-
                =Max(
                    Gallery2_2.AllItems,
                    ThisRecord.'2semanas_2'.Text
                )
            Width: =75
            X: =532
            ZIndex: =6

        "'1Mes_2' As label":
            Align: =Align.Center
            FontWeight: =FontWeight.Bold
            Size: =14
            Text: |-
                =Max(
                    Gallery2_2.AllItems,
                    ThisRecord.'1mes_2'.Text
                )
            Width: =75
            X: =643
            ZIndex: =7

        "'RTO label_2' As label":
            Align: =Align.Center
            Fill: =ColorFade(cores.cinzento, 0.9)
            FontWeight: =FontWeight.Bold
            Size: =15
            Text: |-
                =If(
                    formMode = 1,
                    "RTO: "
                    &
                    If(
                        IsBlank(RTOTempo),
                        "<4 horas",
                        RTOTempo
                    ),
                    
                    If(
                        Value('4Horas_2'.Text) > RTO_2,
                        RTOTempo,
                        If(
                            Value('24Horas_2'.Text) >= RTO_2,
                            RTOTempo,
                            If(
                                Value('48Horas_2'.Text) >= RTO_2,
                                RTOTempo,
                                If(
                                    Value('1Semana_2'.Text) >= RTO_2,
                                    RTOTempo,
                                    If(
                                        Value('2Semanas_2'.Text) >= RTO_2,
                                        RTOTempo,
                                        If(
                                            Value('1Mes_2'.Text) >= RTO_2,
                                            RTOTempo,
                                            LookUp(
                                                RTOS,
                                                ThisRecord.Atividade.ID = Text('Gallery Data'.Selected.ID)
                                            ).Classificação
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            Width: =734
            Y: =40
            ZIndex: =8

        "'Calculate RTO_2' As button":
            OnSelect: |+
                =UpdateContext({
                    RTO_2: 4,
                    RTOTempo: "<4 horas"
                });
                
                If( Value('4Horas_2'.Text) > RTO_2, UpdateContext({ RTO: Value('4Horas_2'.Text), RTOTempo: "<4 horas"}),If( Value('24Horas_2'.Text) >= RTO_2, UpdateContext({ RTO: Value('24Horas_2'.Text), RTOTempo: "<24 horas" }),If( Value('48Horas_2'.Text) >= RTO_2, UpdateContext({ RTO: Value('48Horas_2'.Text), RTOTempo: "<48 horas" }),If( Value('1Semana_2'.Text) >= RTO_2, UpdateContext({ RTO: Value('1Semana_2'.Text), RTOTempo: "<1 semana" }),If( Value('2Semanas_2'.Text) >= RTO_2, UpdateContext({ RTO: Value('2Semanas_2'.Text), RTOTempo: "<2 semanas" }),If( Value('1Mes_2'.Text) >= RTO_2, UpdateContext({ RTO: Value('1Mes_2'.Text), RTOTempo: "<1 mês" })))))));
                
                
                
                
                /*
                If( Value('4Horas'.Text) > RTO, UpdateContext({ RTO: Value('4Horas'.Text), RTOTempo: "<4 horas"}));
                If( Value('24Horas'.Text) >= RTO, UpdateContext({ RTO: Value('24Horas'.Text), RTOTempo: "<24 horas" }));
                If( Value('48Horas'.Text) >= RTO, UpdateContext({ RTO: Value('48Horas'.Text), RTOTempo: "<48 horas" }));
                If( Value('1Semana'.Text) >= RTO, UpdateContext({ RTO: Value('1Semana'.Text), RTOTempo: "<1 semana" }));
                If( Value('2Semanas'.Text) >= RTO, UpdateContext({ RTO: Value('2Semanas'.Text), RTOTempo: "<2 semanas" }));
                If( Value('1Mes'.Text) >= RTO, UpdateContext({ RTO: Value('1Mes'.Text), RTOTempo: "<1 mês" }));
                */
                
                
                If(
                    Value('4Horas_2'.Text) = 4 Or
                    Value('24Horas_2'.Text) = 4 Or
                    Value('48Horas_2'.Text) = 4 Or
                    Value('1Semana_2'.Text) = 4 Or
                    Value('2Semanas_2'.Text) = 4 Or
                    Value('1Mes_2'.Text) = 4,
                    
                    UpdateIf(
                        AtividadeFormMenu,
                        !(
                            Trim(Lower("Caracterização do Processo")) = Trim(Lower(titulo))
                            Or
                            Trim(Lower("Fatores de Criticidade")) in Trim(Lower(titulo))
                        ),
                
                        {modo: DisplayMode.Edit}
                    ),
                    
                    UpdateIf(
                        AtividadeFormMenu,
                        !(
                            Trim(Lower("Caracterização do Processo")) = Trim(Lower(titulo))
                            Or
                            Trim(Lower("Fatores de Criticidade")) in Trim(Lower(titulo))
                        ),
                        {modo: DisplayMode.Disabled}
                    )
                )
                
                
                
            Text: ="Button"
            Visible: =false
            X: =569
            Y: =40
            ZIndex: =10

        Label8_2 As label:
            Text: |-
                =LookUp(
                    RTOS,
                    ThisRecord.Atividade.ID = Text('Gallery Data'.Selected.ID)
                ).ID
            Visible: =false
            X: =60
            Y: =40
            ZIndex: =11

    "'Caracterização dos Equipamentos_2' As group":
        Height: =5
        Width: =5
        X: =24
        Y: =40
        ZIndex: =18

        "'Caracterização dos equipamentos_2' As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
            DelayItemLoading: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0,
                    DisplayMode.Edit,
                    1,
                    DisplayMode.Edit,
                    DisplayMode.View
                )
            Height: =514
            Items: =collectEquipamentos
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplatePadding: =0
            TemplateSize: =85
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Equipamentos"))
            Width: =945
            X: =382
            Y: =167
            ZIndex: =14

            EquipamentoAtividadeID_2 As combobox:
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                DefaultSelectedItems: =First(Atividades)//LookUp(Atividades, ThisRecord.ID = LastAtividadeId)
                DisplayFields: =["uipp_atividade"]
                DisplayMode: =Parent.DisplayMode
                IsSearchable: =false
                Items: =Choices([@Pessoas].'ID Atividade')
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                SearchFields: =["uipp_atividade"]
                SearchItems: =[]
                SelectMultiple: =false
                Tooltip: =
                Visible: =false
                Width: =205
                Y: =8
                ZIndex: =1

            SeparadorEquipamentos_2 As rectangle:
                BorderColor: =cores.cinzento
                BorderStyle: =BorderStyle.Dashed
                BorderThickness: =0.5
                DisplayMode: =DisplayMode.View
                Fill: =cores.cinzento
                Height: =1
                OnSelect: =Select(Parent)
                Width: =Parent.TemplateWidth
                Y: =Parent.TemplateHeight - Self.Height
                ZIndex: =2

            "'Equipamento Duracao_2' As combobox":
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        LookUp(
                            Choices('Duração (Pessoas)'),
                            ThisItem.Duracao in Text(ThisRecord.Value)
                        )
                    )
                DisplayFields: =["Value"]
                DisplayMode: =Parent.DisplayMode
                Height: =34
                HoverFill: =cores.amareloMontepio
                IsSearchable: =false
                Items: =Choices('Duração (Pessoas)')
                NoSelectionText: ="Tempo"
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PaddingTop: =0
                PressedFill: =cores.amareloMontepio
                SearchFields: =["Value"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =
                Width: =150
                X: =289
                Y: =40
                ZIndex: =7

            "'Equipamento Obs_2' As text":
                BorderColor: =cores.cinzento
                Default: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        ThisItem.Observações
                    )
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                Height: =34
                HintText: ="Observações"
                HoverBorderColor: =cores.cinzento
                HoverFill: =RGBA(255, 255, 255, 1)
                MaxLength: =30
                Mode: =TextMode.MultiLine
                OnChange: =
                PaddingLeft: =3
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =
                Width: =443
                X: =454
                Y: =40
                ZIndex: =8

            "'Equipamentos Remove_4' As icon.Add":
                Color: =cores.cinzento
                Height: =30
                Icon: =Icon.Trash
                OnSelect: |-
                    =Select(Parent);
                    RemoveIf(
                        collectEquipamentos,
                        ThisRecord.row = ThisItem.row
                    )
                Visible: |-
                    =If(currentUser = "DRI", false, true)
                    And 
                    AtividadeRecord.Estado = 'Estado Processo'.'Em preenchimento'
                    And 
                    If(formMode = 2, false,true)
                Width: =30
                X: =900
                Y: =30
                ZIndex: =9

            Equipamento_2 As combobox:
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |-
                    =LookUp(
                        Choices([@'Equipamentos de Escritório'].Equipamento),
                        ThisItem.Equipamento.Equipamento in ThisRecord.Equipamento
                    )
                DisplayFields: =["uipp_equipamento"]
                DisplayMode: =Parent.DisplayMode
                FocusedBorderColor: =cores.cinzento
                Height: =34
                HoverBorderColor: =cores.cinzento
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: ="Equipamento"
                IsSearchable: =false
                Items: =Choices([@'Equipamentos de Escritório'].Equipamento)
                NoSelectionText: ="Equipamento"
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PaddingTop: =0
                PressedBorderColor: =cores.cinzento
                PressedFill: =cores.amareloMontepio
                SearchFields: =["uipp_equipamento"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =
                Width: =275
                Y: =40
                ZIndex: =10

            Label9_6 As label:
                Height: =17
                OnSelect: =Select(Parent)
                Text: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        ThisItem.ID
                    )
                Visible: =false
                Width: =56
                X: =924
                Y: =73
                ZIndex: =11

            Llbtitulo_25 As Text:
                DisplayMode: =Parent.DisplayMode
                Height: =32
                Size: =12
                Text: ="Duração"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Visible: =true
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =96
                X: =289
                Y: =8
                ZIndex: =12

            Llbtitulo_24 As Text:
                DisplayMode: =Parent.DisplayMode
                Height: =32
                Size: =12
                Text: ="Equipamento"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Visible: =true
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =96
                X: =0
                Y: =8
                ZIndex: =13

            Llbtitulo_26 As Text:
                DisplayMode: =Parent.DisplayMode
                Height: =32
                Size: =12
                Text: ="Observações"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Visible: =true
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =96
                X: =454
                Y: =8
                ZIndex: =14

        AddEquipamentoBTN_2 As groupContainer:
            Height: =40
            Visible: |-
                =(
                    Value('4Horas_2'.Text) = 4 Or
                    Value('24Horas_2'.Text) = 4 Or
                    Value('48Horas_2'.Text) = 4 Or
                    Value('1Semana_2'.Text) = 4 Or
                    Value('2Semanas_2'.Text) = 4 Or
                    Value('1Mes_2'.Text) = 4
                )
                And
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Equipamentos"))
                And
                If(formMode = 2 , false, true)
            Width: =197
            X: =731
            Y: =655
            ZIndex: =16

            DynamicBtn_15 As DynamicBtn:
                BtnText: ="Adic. Equip."
                BtnWidth: =200
                Height: =40
                Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Equipamentos"))
                Width: =201
                ZIndex: =1

            "'Add Equipamento_2' As button":
                AutoDisableOnSelect: =false
                BorderColor: =Color.Transparent
                DisabledBorderColor: =Color.Transparent
                DisabledFill: =Color.Transparent
                Fill: =Color.Transparent
                HoverBorderColor: =Color.Transparent
                HoverFill: =Color.Transparent
                OnSelect: |-
                    =Collect(collectEquipamentos, {row: Last(collectEquipamentos).row + 1})
                PressedFill: =Color.Transparent
                Size: =13
                Text: =""
                Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Equipamentos"))
                Width: =201
                ZIndex: =2

    "'Caracterização dos Sistemas_2' As group":
        Height: =5
        Width: =5
        X: =24
        Y: =40
        ZIndex: =20

        "'Caracterização dos sistemas_2' As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
            DelayItemLoading: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0,
                    DisplayMode.Edit,
                    1,
                    DisplayMode.Edit,
                    DisplayMode.View
                )
            Height: =514
            Items: =collectSistemas
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplatePadding: =0
            TemplateSize: =111
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Sistemas"))
            Width: =945
            X: =382
            Y: =167
            ZIndex: =17

            SistemasAtividadeID_2 As combobox:
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                DefaultSelectedItems: =First(Atividades)//LookUp(Atividades, ThisRecord.ID = LastAtividadeId)
                DisplayFields: =["uipp_atividade"]
                DisplayMode: =Parent.DisplayMode
                IsSearchable: =false
                Items: =Choices([@Pessoas].'ID Atividade')
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                SearchFields: =["uipp_atividade"]
                SearchItems: =[]
                SelectMultiple: =false
                Tooltip: =
                Visible: =false
                Width: =205
                ZIndex: =1

            SeparadorSistemas_2 As rectangle:
                BorderColor: =cores.cinzento
                BorderStyle: =BorderStyle.Dashed
                BorderThickness: =0.5
                DisplayMode: =DisplayMode.View
                Fill: =cores.cinzento
                Height: =1
                OnSelect: =Select(Parent)
                Width: =Parent.TemplateWidth
                Y: =Parent.TemplateHeight - Self.Height
                ZIndex: =2

            "'Sistemas Remove_2' As icon.Add":
                Color: =cores.cinzento
                Height: =30
                Icon: =Icon.Trash
                OnSelect: |-
                    =Select(Parent);
                    RemoveIf(
                        collectSistemas,
                        ThisRecord.row = ThisItem.row
                    )
                Visible: |-
                    =If(currentUser = "DRI", false, true)
                    And 
                    AtividadeRecord.Estado = 'Estado Processo'.'Em preenchimento'
                    And 
                    If(formMode = 2, false,true)
                Width: =30
                X: =900
                Y: =28
                ZIndex: =3

            "'Sistemas Obs_2' As text":
                BorderColor: =cores.cinzento
                Default: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        ThisItem.Observações
                    )
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                Height: =59
                HintText: ="Observações"
                HoverBorderColor: =cores.cinzento
                HoverFill: =RGBA(255, 255, 255, 1)
                MaxLength: =100
                Mode: =TextMode.MultiLine
                OnChange: =
                PaddingLeft: =2
                PaddingTop: =10
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =
                Width: =260
                X: =610
                Y: =40
                ZIndex: =4

            "'Sistemas Descrição_2' As text":
                BorderColor: =cores.cinzento
                Default: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        ThisItem.Descricao
                    )
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                Height: =59
                HintText: ="Descrição"
                HoverBorderColor: =cores.cinzento
                HoverFill: =RGBA(255, 255, 255, 1)
                MaxLength: =100
                Mode: =TextMode.MultiLine
                OnChange: =
                PaddingLeft: =2
                PaddingTop: =10
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =
                Width: =260
                X: =341
                Y: =40
                ZIndex: =5

            "'Sistemas Duracao_2' As combobox":
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        LookUp(
                            Choices('Duração (Pessoas)'),
                            ThisItem.Duracao in Text(ThisRecord.Value)
                        )
                    )
                DisplayFields: =["Value"]
                DisplayMode: =Parent.DisplayMode
                Height: =41
                HoverFill: =cores.amareloMontepio
                IsSearchable: =false
                Items: =Choices('Duração (Pessoas)')
                NoSelectionText: ="Tempo"
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PressedFill: =cores.amareloMontepio
                SearchFields: =["Value"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =
                Width: =114
                X: =220
                Y: =40
                ZIndex: =6

            Sistema_2 As combobox:
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        LookUp(
                            Choices([@Sistemas].'Sistemas/Aplicações'),
                            ThisItem.Sistema.Nome in ThisRecord.Nome
                        )
                    )
                DisplayFields: =["uipp_nome"]
                DisplayMode: =Parent.DisplayMode
                Height: =41
                HoverBorderColor: =ColorFade(cores.cinzento, 15%)
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: ="Sistema/App"
                IsSearchable: =false
                Items: =Choices([@Sistemas].'Sistemas/Aplicações')
                NoSelectionText: ="Sistema/App"
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PressedFill: =cores.amareloMontepio
                SearchFields: =["uipp_nome"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =Self.Selected.Nome
                Width: =214
                Y: =40
                ZIndex: =7

            Label9_7 As label:
                Height: =17
                OnSelect: =Select(Parent)
                Text: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        ThisItem.ID
                    )
                Visible: =false
                Width: =56
                X: =924
                Y: =73
                ZIndex: =8

            TextCanvas8_8 As Text:
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Size: =12
                Text: ="Sistema"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =96
                X: =0
                Y: =8
                ZIndex: =9

            TextCanvas8_9 As Text:
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Size: =12
                Text: ="Duração"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =96
                X: =220
                Y: =8
                ZIndex: =10

            TextCanvas8_10 As Text:
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Size: =12
                Text: ="Descrição"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =96
                X: =341
                Y: =8
                ZIndex: =11

            TextCanvas8_11 As Text:
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Size: =12
                Text: ="Observações"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =96
                X: =610
                Y: |
                    =8
                ZIndex: =12

        AddSistemasBTN_2 As groupContainer:
            Height: =40
            Visible: |-
                =(
                    Value('4Horas_2'.Text) = 4 Or
                    Value('24Horas_2'.Text) = 4 Or
                    Value('48Horas_2'.Text) = 4 Or
                    Value('1Semana_2'.Text) = 4 Or
                    Value('2Semanas_2'.Text) = 4 Or
                    Value('1Mes_2'.Text) = 4
                )
                And
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Sistemas"))
                And
                If(formMode = 2 , false, true)
            Width: =194
            X: =731
            Y: =655
            ZIndex: =18

            DynamicBtn_16 As DynamicBtn:
                BtnText: ="Adic. Sistema"
                BtnWidth: =200
                Height: =40
                Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Sistemas"))
                Width: =201
                ZIndex: =1

            "'Add Sistemas_2' As button":
                AutoDisableOnSelect: =false
                BorderColor: =Color.Transparent
                DisabledBorderColor: =Color.Transparent
                DisabledFill: =Color.Transparent
                Fill: =Color.Transparent
                HoverBorderColor: =Color.Transparent
                HoverFill: =Color.Transparent
                OnSelect: |-
                    =Collect(collectSistemas, {row: Last(collectSistemas).row + 1})
                PressedFill: =Color.Transparent
                Size: =13
                Text: =""
                Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Sistemas"))
                Width: =201
                ZIndex: =2

    Header_2 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =20

        "'Passos do Registo de Atividade_2' As gallery.'BrowseLayout_Horizontal_TwoTextOneImageVariant_ver5.0'":
            DelayItemLoading: =true
            DisplayMode: |
                =DisplayMode.Edit
            Height: =61
            Items: =AtividadeFormMenu
            LoadingSpinner: =LoadingSpinner.Data
            TemplatePadding: =0
            TemplateSize: ='Passos do Registo de Atividade_2'.Width / 'Passos do Registo de Atividade_2'.AllItemsCount
            Width: =945
            X: =382
            Y: =91
            ZIndex: =20

            Rectangle4_2 As rectangle:
                Fill: |-
                    =If(
                        formMode = 2,
                        Color.Green,
                        Switch(
                            ThisItem.estado,
                            "em curso",
                            cores.amareloMontepio,
                            "em falta",
                            Color.Red,
                            "feito",
                            Color.Green
                        )
                    )
                Height: =2
                OnSelect: =Select(Parent)
                Width: =Parent.Width / Parent.AllItemsCount
                Y: =47
                ZIndex: =1

            Label2_2 As label:
                Align: =Align.Center
                DisplayMode: |-
                    =/*If(
                        ThisItem.titulo = "Caracterização do Processo" Or ThisItem.titulo = "Fatores de Criticidade",
                        
                        DisplayMode.Edit,
                        
                        If(
                            Value('4Horas'.Text) = 4 Or
                            Value('24Horas'.Text) = 4 Or
                            Value('48Horas'.Text) = 4 Or
                            Value('1Semana'.Text) = 4 Or
                            Value('2Semanas'.Text) = 4 Or
                            Value('1Mes'.Text) = 4,
                    
                            DisplayMode.Edit,
                    
                            DisplayMode.Disabled
                        )
                    )*/
                    ThisItem.modo
                FontWeight: |-
                    =If(
                        ThisItem.IsSelected,
                        FontWeight.Bold,
                        FontWeight.Normal
                    )
                Height: =61
                OnSelect: |-
                    =If(
                        ThisItem.titulo <> "Caracterização do Processo" Or ThisItem.titulo <> "Fatores de Criticidade",
                        If(
                            Value('4Horas_2'.Text) = 4 Or
                            Value('24Horas_2'.Text) = 4 Or
                            Value('48Horas_2'.Text) = 4 Or
                            Value('1Semana_2'.Text) = 4 Or
                            Value('2Semanas_2'.Text) = 4 Or
                            Value('1Mes_2'.Text) = 4,
                            
                            Select(Parent);
                            If(
                                ThisItem.estado <> "feito",
                                Patch(
                                    AtividadeFormMenu,
                                    LookUp(
                                        AtividadeFormMenu,
                                        Trim(Lower(ThisRecord.titulo)) = Trim(Lower(ThisItem.titulo))
                                    ),
                                    {
                                        estado: "em curso"
                                    }
                                )
                            ),
                            false
                        ),
                        false
                    )
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingTop: =0
                Size: =12
                Text: =ThisItem.titulo
                VerticalAlign: =VerticalAlign.Top
                Width: =Parent.Width / Parent.AllItemsCount
                ZIndex: =2

        "'Title Container_2' As groupContainer":
            DropShadow: =DropShadow.None
            Height: =47
            Width: =1026
            X: =319
            Y: =28
            ZIndex: =22

            Label1_12 As label:
                Size: =15
                Text: |-
                    ="Atividades > " &
                    If(
                        formMode = FormMode.New,
                        "Criar registo de Atividade",
                        "Editar registo de Atividade"
                    )
                Width: =610
                X: =40
                ZIndex: =1

            SaveEditBtn_2 As DynamicBtn:
                BtnText: |-
                    =If(
                        currentUser <> "DRI",
                        If(
                            formMode = 2,
                            "Editar",
                            "Guardar"
                        ),
                        If(
                            AtividadeRecord.'Unidade Orgânica' = "DRI" Or formMode = 1,
                            If(
                                formMode = 2,
                                "Editar",
                                "Guardar"
                            )
                        )
                    )
                BtnWidth: =200
                ButtonIcon: |-
                    =If(
                        currentUser <> "DRI",
                        If(
                            formMode = 2,
                            Icon.Edit,
                            Icon.Save
                        ),
                        If(
                            AtividadeRecord.'Unidade Orgânica' = "DRI" Or formMode = 1,
                            If(
                                formMode = 2,
                                Icon.Edit,
                                Icon.Save
                            )
                        )
                    )
                Height: =40
                Visible: =AtividadeRecord.Estado = 'Estado Processo'.'Em preenchimento' Or formMode = 1
                Width: =201
                X: =790
                Y: =5
                ZIndex: =2

            SaveEditBtnCode_2 As button:
                Color: =Color.Transparent
                Fill: =Color.Transparent
                HoverColor: =Color.Transparent
                HoverFill: =Color.Transparent
                OnSelect: |-
                    =If(
                        formMode = 2,
                        UpdateContext({formMode: FormMode.Edit}),
                    // Submeter Caracterização do Processo
                    If(
                        'Caracterizacao do Processo_2'.Valid
                        And
                        (
                            LookUp(
                                AtividadeFormMenu,
                                Trim(Lower(titulo)) = Trim(Lower("Caracterização do Processo"))
                            ).estado = "feito"
                            And
                            LookUp(
                                AtividadeFormMenu,
                                Trim(Lower(titulo)) = Trim(Lower("Fatores de Criticidade"))
                            ).estado = "feito"
                        )
                        And
                        //Criticidade do Processo
                        (
                            !IsBlank(First(Gallery2_2.AllItems).'4horas_2'.Text) And If(
                                !IsBlank(First(Gallery2_2.AllItems).'24horas_2'.Text),
                                Value(First(Gallery2_2.AllItems).'4horas_2'.Text) <= Value(First(Gallery2_2.AllItems).'24horas_2'.Text),
                                true
                            ) And If(
                                !IsBlank(First(Gallery2_2.AllItems).'48horas_2'.Text),
                                Value(First(Gallery2_2.AllItems).'24horas_2'.Text) <= Value(First(Gallery2_2.AllItems).'48horas_2'.Text),
                                true
                            ) And If(
                                !IsBlank(First(Gallery2_2.AllItems).'1semana_2'.Text),
                                Value(First(Gallery2_2.AllItems).'48horas_2'.Text) <= Value(First(Gallery2_2.AllItems).'1semana_2'.Text),
                                true
                            ) And If(
                                !IsBlank(First(Gallery2_2.AllItems).'2semanas_2'.Text),
                                Value(First(Gallery2_2.AllItems).'1semana_2'.Text) <= Value(First(Gallery2_2.AllItems).'2semanas_2'.Text),
                                true
                            ) And If(
                                !IsBlank(First(Gallery2_2.AllItems).'1mes_2'.Text),
                                Value(First(Gallery2_2.AllItems).'2semanas_2'.Text) <= Value(First(Gallery2_2.AllItems).'1mes_2'.Text),
                                true
                            )
                        ),
                        //em caso de sucesso
                        UpdateContext(
                            {
                                ModalForm: {
                                    visible: true,
                                    texto: "Deseja submeter os dados da Atividade " & "?"
                                }
                            }
                        )
                      ,
                        //em caso de erro
                        Notify( "Preencha todos os campos necessários, verifique se existem registos em branco e tente novamente", NotificationType.Error, 4000)
                      
                    )
                    )
                PressedColor: =Color.Transparent
                PressedFill: =Color.Transparent
                Text: =""
                Visible: =AtividadeRecord.Estado = 'Estado Processo'.'Em preenchimento' Or formMode = 1
                Width: =201
                X: =790
                Y: =5
                ZIndex: =3

            CancelAndAporoveBtn_2 As DynamicBtn:
                BtnText: |-
                    =If(
                        formMode = 0,
                        "Cancelar",
                        "Pedir Aprovação"
                    )
                BtnWidth: =215
                ButtonIcon: |-
                    =If(
                        formMode = 0,
                        Icon.Cancel,
                        Icon.Send
                    )
                Height: =40
                Visible: |-
                    =(
                        AtividadeRecord.Estado = 'Estado Processo'.'Em validação'
                        Or
                        AtividadeRecord.Estado = 'Estado Processo'.'Em revalidação'
                        Or 
                            AtividadeRecord.Estado = 'Estado Processo'.'Em preenchimento'
                    )
                    And
                    currentUser = 'Gallery Data'.Selected.'Unidade Orgânica'
                Width: =207
                X: |-
                    =If(
                        HistoricoBtn_2.Visible Or
                        SaveEditBtn_2.Visible,
                        570,
                        790
                    )
                Y: =5
                ZIndex: =4

            CancelAndAporoveBtnCode_2 As button:
                Color: =Color.Transparent
                Fill: =Color.Transparent
                HoverColor: =Color.Transparent
                HoverFill: =Color.Transparent
                OnSelect: |-
                    =If(
                        formMode = 0,
                        
                        UpdateContext({formMode: FormMode.View}),
                        
                        Concurrent(
                            Patch(
                                Atividades,
                                LookUp(
                                    Atividades,
                                    ThisRecord.ID = 'Gallery Data_6'.Selected.ID
                                ),
                                {
                                    Estado: 'Estado Processo'.'Em validação'
                                }
                            ),
                    
                            Patch(
                                'Histórico de aprovações',
                                Defaults('Histórico de aprovações'),
                                {
                                    Estado: 'Estado Processo'.'Em validação',
                                    'ID Atividade':
                                        LookUp(
                                            Atividades,
                                            ThisRecord.ID = 'Gallery Data'.Selected.ID
                                        )
                                }
                            ),
                    
                            'GCN-Pediraprovação'.Run(
                                'Gallery Data_6'.Selected.ID,
                                currentUser,
                                'Gallery Data_6'.Selected.Atividade
                            ),
                            Notify("Pedido de Aprovação enviado com sucesso", NotificationType.Success)
                        )
                    )
                PressedColor: =Color.Transparent
                PressedFill: =Color.Transparent
                Text: =""
                Visible: |-
                    =(
                        AtividadeRecord.Estado = 'Estado Processo'.'Em validação'
                        Or
                        AtividadeRecord.Estado = 'Estado Processo'.'Em revalidação'
                         Or
                        AtividadeRecord.Estado = 'Estado Processo'.'Em preenchimento'
                    )
                    And
                    currentUser = 'Gallery Data'.Selected.'Unidade Orgânica'
                Width: =201
                X: |-
                    =If(
                        HistoricoBtn_2.Visible
                        Or
                        SaveEditBtn_2.Visible,
                        576,
                        790
                    )
                Y: =5
                ZIndex: =5

            HistoricoBtn_2 As DynamicBtn:
                BtnText: ="Histórico"
                BtnWidth: =200
                ButtonIcon: =Icon.History
                Height: =40
                Visible: |-
                    =AtividadeRecord.Estado <> 'Estado Processo'.'Em preenchimento'
                    And
                    formMode = 2
                    And
                    !IsBlank(
                        Filter(
                            'Histórico de aprovações',
                            ThisRecord.'ID Atividade'.ID = 'Gallery Data'.Selected.ID
                        )
                    )
                Width: =201
                X: =790
                Y: =5
                ZIndex: =6

            HistoricoBtnCode_2 As button:
                Color: =Color.Transparent
                Fill: =Color.Transparent
                HoverColor: =Color.Transparent
                HoverFill: =Color.Transparent
                OnSelect: |-
                    =Navigate(
                        'Histórico de Aprovações',
                        ScreenTransition.None,
                        {
                            recordId: 'Gallery Data'.Selected.ID
                        }
                    )
                PressedColor: =Color.Transparent
                PressedFill: =Color.Transparent
                Text: =""
                Visible: |-
                    =AtividadeRecord.Estado <> 'Estado Processo'.'Em preenchimento'
                    And
                    formMode = 2
                    And
                    !IsBlank(
                        Filter(
                            'Histórico de aprovações',
                            ThisRecord.'ID Atividade'.ID = 'Gallery Data'.Selected.ID
                        )
                    )
                Width: =201
                X: =790
                Y: =5
                ZIndex: =7

    "'Caracterização dos Recursos_2' As group":
        Height: =5
        Width: =5
        X: =60
        Y: =60
        ZIndex: =22

        "'Caracterização dos recursos_2' As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
            DelayItemLoading: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0,
                    DisplayMode.Edit,
                    1,
                    DisplayMode.Edit,
                    DisplayMode.View
                )
            Height: =514
            Items: =collectRecursos
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplatePadding: =0
            TemplateSize: =162
            Visible: |-
                =(
                    Value('4Horas_2'.Text) = 4 Or
                    Value('24Horas_2'.Text) = 4 Or
                    Value('48Horas_2'.Text) = 4 Or
                    Value('1Semana_2'.Text) = 4 Or
                    Value('2Semanas_2'.Text) = 4 Or
                    Value('1Mes_2'.Text) = 4
                )
                And
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Recursos"))
            Width: =960
            X: =382
            Y: =165
            ZIndex: =13

            AtividadeID_4 As combobox:
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                DefaultSelectedItems: =First(Atividades)//LookUp(Atividades, ThisRecord.ID = LastAtividadeId)
                DisplayFields: =["uipp_atividade"]
                DisplayMode: =Parent.DisplayMode
                IsSearchable: =false
                Items: =Choices([@Pessoas].'ID Atividade')
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                SearchFields: =["uipp_atividade"]
                SearchItems: =[]
                SelectMultiple: =false
                Tooltip: =
                Visible: =false
                Width: =205
                ZIndex: =1

            SeparadorRecursos_2 As rectangle:
                BorderColor: =cores.cinzento
                BorderStyle: =BorderStyle.Dashed
                BorderThickness: =0.5
                DisplayMode: =DisplayMode.View
                Fill: =cores.cinzento
                Height: =1
                OnSelect: =Select(Parent)
                Width: =Parent.TemplateWidth
                Y: =Parent.TemplateHeight - Self.Height
                ZIndex: =2

            NumEmpregado_2 As text:
                BorderColor: =cores.cinzento
                Default: |-
                    =If(
                        formMode = FormMode.New,
                        "",
                        ThisItem.NumEmpregado
                    )
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                HintText: ="Núm. Empregado"
                HoverBorderColor: =cores.cinzento
                HoverFill: =RGBA(255, 255, 255, 1)
                MaxLength: =10
                OnChange: |-
                    =If(
                        !IsBlank(NumEmpregado_2.Text) And !IsBlank(Critico_4.Text) And !IsBlank(Teletrabalho_2.Selected.Value) And !IsBlank(Tipo_2.Selected.ID) And !IsBlank(Duracao_2.Selected.Value),
                        
                        Patch(
                            AtividadeFormMenu,
                            LookUp(
                                AtividadeFormMenu,
                                Trim(Lower(ThisRecord.titulo)) = Trim(Lower("Caracterização do Recursos"))
                            ),
                            {
                                estado: "feito"
                            }
                        ),
                    
                        Patch(
                            AtividadeFormMenu,
                            LookUp(
                                AtividadeFormMenu,
                                Trim(Lower(ThisRecord.titulo)) = Trim(Lower("Caracterização do Recursos"))
                            ),
                            {
                                estado: "em curso"
                            }
                        )
                    )
                PaddingLeft: =3
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =
                Width: =125
                Y: =30
                ZIndex: =3

            Critico_4 As text:
                BorderColor: =cores.cinzento
                Default: |-
                    =If(
                        formMode = FormMode.New,
                        "",
                        ThisItem.Colaborador
                    )
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                HintText: ="Nome do Colaborador"
                HoverBorderColor: =cores.cinzento
                HoverFill: =RGBA(255, 255, 255, 1)
                MaxLength: =30
                OnChange: =
                PaddingLeft: =5
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: =
                Width: =236
                X: =172
                Y: =30
                ZIndex: =4

            Teletrabalho_2 As combobox:
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        LookUp(
                            Choices('Teletrabalho (Pessoas)'),
                            ThisItem.Teletrabalho in Text(ThisRecord.Value)
                        )
                    )
                DisplayFields: =["Value"]
                DisplayMode: =Parent.DisplayMode
                Height: =43
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: =""
                IsSearchable: =false
                Items: |
                    =Choices('Teletrabalho (Pessoas)')
                NoSelectionText: ="Teletrabalho"
                OnChange: =
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PressedFill: =cores.amareloMontepio
                SearchFields: =["Value"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =
                Width: =110
                Y: =102
                ZIndex: =5

            Tipo_2 As combobox:
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |
                    =LookUp(
                        Choices([@Pessoas].Tipo),
                        ThisItem.Tipo in ThisRecord.Tipo
                    )
                DisplayFields: =["uipp_tipo"]
                DisplayMode: =Parent.DisplayMode
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: =""
                IsSearchable: =false
                Items: =Choices([@Pessoas].Tipo)
                NoSelectionText: ="Tipo Colab."
                OnChange: =
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PressedFill: =cores.amareloMontepio
                SearchFields: =["uipp_tipo"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =
                Width: =140
                X: =173
                Y: =102
                ZIndex: =6

            Duracao_2 As combobox:
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        LookUp(
                            Choices('Duração (Pessoas)'),
                            ThisItem.Duracao in Text(ThisRecord.Value)
                        )
                    )
                DisplayFields: =["Value"]
                DisplayMode: =Parent.DisplayMode
                HoverFill: =cores.amareloMontepio
                IsSearchable: =false
                Items: =Choices('Duração (Pessoas)')
                NoSelectionText: ="Tempo"
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PressedFill: =cores.amareloMontepio
                SearchFields: =["Value"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =
                Width: =150
                X: =419
                Y: =30
                ZIndex: =7

            Critico_5 As text:
                BorderColor: =cores.cinzento
                Default: |-
                    =If(
                        formMode = FormMode.New,
                        "",
                        ThisItem.Observações
                    )
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                Height: =43
                HintText: ="Observações"
                HoverBorderColor: =cores.cinzento
                HoverFill: =RGBA(255, 255, 255, 1)
                MaxLength: =30
                Mode: =TextMode.MultiLine
                OnChange: =
                PaddingLeft: =3
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Size: =12
                Tooltip: ="Observações"
                Width: =481
                X: =419
                Y: =102
                ZIndex: =8

            Icon3_2 As icon.Add:
                Color: =cores.cinzento
                Height: =30
                Icon: =Icon.Trash
                OnSelect: |-
                    =Select(Parent);
                    RemoveIf(
                        collectRecursos,
                        ThisRecord.row = ThisItem.row
                    )
                Visible: |-
                    =If(currentUser = "DRI", false, true)
                    And 
                    AtividadeRecord.Estado = 'Estado Processo'.'Em preenchimento'
                    And 
                    If(formMode = 2, false,true)
                Width: =30
                X: =900
                Y: =40
                ZIndex: =9

            Label6_2 As label:
                OnSelect: =Select(Parent)
                Text: =ThisItem.ID
                Visible: =false
                Width: =56
                X: =924
                Y: =80
                ZIndex: =10

            Llbtitulo_18 As Text:
                DisplayMode: =Parent.DisplayMode
                Height: =32
                Size: =12
                Text: ="Número Empregado"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Visible: =true
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =136
                X: =0
                Y: =0
                ZIndex: =11

            Llbtitulo_19 As Text:
                DisplayMode: =Parent.DisplayMode
                Height: =32
                Size: =12
                Text: ="Nome Colaborador(a)"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Visible: =true
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =141
                X: =172
                Y: =0
                ZIndex: =12

            Llbtitulo_21 As Text:
                DisplayMode: =Parent.DisplayMode
                Height: =32
                Size: =12
                Text: ="Observações"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Visible: =true
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =141
                X: =419
                Y: =70
                ZIndex: =13

            Llbtitulo_22 As Text:
                DisplayMode: =Parent.DisplayMode
                Height: =32
                Size: =12
                Text: ="Teletrabalho"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Visible: =true
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =110
                X: =0
                Y: =74
                ZIndex: =14

            Llbtitulo_23 As Text:
                DisplayMode: =Parent.DisplayMode
                Height: =32
                Size: =12
                Text: ="Principal/Substituto"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Visible: =true
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =130
                X: =172
                Y: =74
                ZIndex: =15

            Llbtitulo_20 As Text:
                DisplayMode: =Parent.DisplayMode
                Height: =32
                Size: =12
                Text: ="Duração"
                VerticalAlign: ='TextCanvas.VerticalAlign'.Middle
                Visible: =true
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =141
                X: =419
                Y: =0
                ZIndex: =16

        AddRecursoBTN_2 As groupContainer:
            Height: =40
            Visible: |-
                =(
                    Value('4Horas_2'.Text) = 4 Or
                    Value('24Horas_2'.Text) = 4 Or
                    Value('48Horas_2'.Text) = 4 Or
                    Value('1Semana_2'.Text) = 4 Or
                    Value('2Semanas_2'.Text) = 4 Or
                    Value('1Mes_2'.Text) = 4
                )
                And
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Recursos"))
                And
                If(formMode = 2 , false, true)
            Width: =197
            X: =731
            Y: =655
            ZIndex: =15

            DynamicBtn_14 As DynamicBtn:
                BtnText: ="Adic. Recurso"
                BtnWidth: =200
                Height: =40
                Width: =201
                ZIndex: =1

            "'Add Recurso_2' As button":
                BorderColor: =Color.Transparent
                DisabledBorderColor: =Color.Transparent
                DisabledFill: =Color.Transparent
                Fill: =Color.Transparent
                HoverBorderColor: =Color.Transparent
                HoverFill: =Color.Transparent
                OnSelect: |-
                    =Collect(collectRecursos, {row: Last(collectRecursos).row + 1})
                PaddingBottom: =0
                PaddingLeft: =0
                PaddingRight: =0
                PaddingTop: =0
                PressedFill: =Color.Transparent
                Size: =13
                Text: =""
                Visible: |
                    =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização dos Recursos"))
                Width: =200
                ZIndex: =2

    Label7_4 As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Bold
        Size: =15
        Text: ="Sem dados para apresentar, de momento"
        Visible: |-
            =Switch(
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)),
                
                Trim(Lower("Caracterização dos Recursos")),
                If(CountRows(collectRecursos) = 0, true, false),
            
                Trim(Lower("Caracterização dos Equipamentos")),
                If(CountRows(collectEquipamentos) = 0, true, false),
            
                Trim(Lower("Caracterização dos Sistemas")),
                If(CountRows(collectSistemas) = 0, true, false),
            
                Trim(Lower("Dependências")),
                If(CountRows(collectDependencias) = 0, true, false)
            )
        Width: =980
        X: =362
        Y: =165
        ZIndex: =23

    "'Caracterização das Dependencias_2' As group":
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =23

        "'Caracterização das dependencias_2' As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0'":
            DelayItemLoading: =true
            DisplayMode: |-
                =Switch(
                    formMode,
                    0,
                    DisplayMode.Edit,
                    1,
                    DisplayMode.Edit,
                    DisplayMode.View
                )
            Height: =514
            Items: =collectDependencias
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplatePadding: =0
            TemplateSize: =321
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Dependências"))
            Width: =945
            X: =382
            Y: =167
            ZIndex: =19

            AtividadeID_5 As combobox:
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                DefaultSelectedItems: =First(Atividades)//LookUp(Atividades, ThisRecord.ID = LastAtividadeId)
                DisplayFields: =["uipp_atividade"]
                DisplayMode: =Parent.DisplayMode
                Height: =32
                IsSearchable: =false
                Items: =Choices([@Pessoas].'ID Atividade')
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                SearchFields: =["uipp_atividade"]
                SearchItems: =[]
                SelectMultiple: =false
                Tooltip: =
                Visible: =false
                Width: =205
                ZIndex: =1

            SeparadorDependencias_2 As rectangle:
                BorderColor: =cores.cinzento
                BorderStyle: =BorderStyle.Dashed
                BorderThickness: =1
                DisplayMode: =DisplayMode.View
                Fill: =cores.cinzento
                Height: =1
                OnSelect: =Select(Parent)
                Width: =Parent.TemplateWidth
                Y: =Parent.TemplateHeight - Self.Height
                ZIndex: =2

            "'Dependencias Observacoes_2' As text":
                BorderColor: =cores.cinzento
                Default: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        ThisItem.Observações
                    )
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                Height: =89
                HintText: ="Observações"
                HoverBorderColor: =cores.cinzento
                HoverFill: =RGBA(255, 255, 255, 1)
                MaxLength: =100
                Mode: =TextMode.MultiLine
                OnChange: =
                PaddingLeft: =3
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: ="Observações"
                Width: =505
                X: =393
                Y: =156
                ZIndex: =3

            "'Dependencias Informacao_2' As text":
                BorderColor: =cores.cinzento
                Default: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        ThisItem.Informacao
                    )
                DelayOutput: =true
                DisplayMode: =Parent.DisplayMode
                Height: =89
                HintText: ="Informação de suporte"
                HoverBorderColor: =cores.cinzento
                HoverFill: =RGBA(255, 255, 255, 1)
                MaxLength: =100
                Mode: =TextMode.MultiLine
                OnChange: =
                PaddingLeft: =3
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Tooltip: ="Observações"
                Width: =505
                X: =395
                Y: =32
                ZIndex: =4

            "'Dependencias Remove_2' As icon.Add":
                Color: =cores.cinzento
                Height: =30
                Icon: =Icon.Trash
                OnSelect: |-
                    =Select(Parent);
                    RemoveIf(
                        collectDependencias,
                        ThisRecord.row = ThisItem.row
                    )
                Visible: |-
                    =If(currentUser = "DRI", false, true)
                    And 
                    AtividadeRecord.Estado = 'Estado Processo'.'Em preenchimento'
                    And 
                    If(formMode = 2, false,true)
                Width: =30
                X: =900
                Y: =125
                ZIndex: =5

            "'Dependencias UO_2' As combobox":
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        LookUp(
                            Choices([@Dependências].uipp_UnidadeOrganica),
                            ThisItem.Unidade.Unidade in ThisRecord.Unidade
                        )
                    )
                DisplayFields: =["uipp_unidade"]
                DisplayMode: =Parent.DisplayMode
                HoverBorderColor: =cores.cinzento
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: ="Unidades Orgânicas"
                IsSearchable: =false
                Items: =Choices([@Dependências].'Unidade Orgânica')
                NoSelectionText: ="Unidades Orgânicas"
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PressedFill: =cores.amareloMontepio
                SearchFields: =["uipp_unidade"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =
                Width: =368
                Y: =252
                ZIndex: =6

            "'Dependencias Tipo_2' As combobox":
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        LookUp(
                            Choices('Tipo de Dependência'),
                            ThisItem.Tipo in Text(ThisRecord.Value)
                        )
                    )
                DisplayFields: =["Value"]
                DisplayMode: =Parent.DisplayMode
                HoverBorderColor: =cores.cinzento
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: ="Tipo de Dependência"
                IsSearchable: =false
                Items: =Choices('Tipo de Dependência')
                NoSelectionText: ="Tipo de Dependência"
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PressedFill: =cores.amareloMontepio
                SearchFields: =["Value"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Width: =368
                Y: =180
                ZIndex: =7

            "'Dependencias Importancia_2' As combobox":
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        LookUp(
                            Choices(Importância),
                            ThisItem.Importancia in Text(ThisRecord.Value)
                        )
                    )
                DisplayFields: =["Value"]
                DisplayMode: =Parent.DisplayMode
                HoverBorderColor: =cores.cinzento
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: ="Importância"
                IsSearchable: =false
                Items: =Choices(Importância)
                NoSelectionText: ="Importância"
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PressedFill: =cores.amareloMontepio
                SearchFields: =["Value"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =
                Width: =176
                Y: =104
                ZIndex: =9

            "'Dependencias Entidades_2' As combobox":
                BorderColor: =cores.cinzento
                ChevronBackground: =cores.amareloMontepio
                ChevronHoverBackground: =ColorFade(cores.amareloMontepio, -20%)
                DefaultSelectedItems: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        LookUp(
                            Choices([@Dependências].uipp_Entidades),
                            ThisItem.Entidade.Nome in ThisRecord.Nome
                        )
                    )
                DisplayFields: =["uipp_nome"]
                DisplayMode: =Parent.DisplayMode
                HoverBorderColor: =cores.cinzento
                HoverFill: =cores.amareloMontepio
                InputTextPlaceholder: ="Entidades"
                IsSearchable: =false
                Items: =Choices([@Dependências].Entidades)
                PaddingLeft: =If(Self.DisplayMode = DisplayMode.Edit, 5, 0)
                PressedFill: =cores.amareloMontepio
                SearchFields: =["uipp_nome"]
                SearchItems: =[]
                SelectionFill: =cores.amareloMontepio
                SelectMultiple: =false
                Tooltip: =
                Width: =368
                Y: =32
                ZIndex: =10

            Label9_8 As label:
                Height: =17
                OnSelect: =Select(Parent)
                Text: |-
                    =If(
                        formMode = FormMode.New,
                        Blank(),
                        ThisItem.ID
                    )
                Visible: =false
                Width: =56
                X: =924
                Y: =198
                ZIndex: =11

            TextCanvas9_17 As Text:
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Size: =12
                Text: ="Unidade Orgância"
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =147
                X: =0
                Y: =220
                ZIndex: =12

            TextCanvas9_16 As Text:
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Size: =12
                Text: ="Tipo de Dependência"
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =147
                X: =0
                Y: =148
                ZIndex: =13

            TextCanvas9_14 As Text:
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Size: =12
                Text: ="Importância"
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =147
                X: =0
                Y: =72
                ZIndex: =14

            TextCanvas9_12 As Text:
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Size: =12
                Text: ="Entidades"
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =147
                X: =0
                Y: =0
                ZIndex: =15

            TextCanvas9_13 As Text:
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Size: =12
                Text: ="Dependência Informação"
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =198
                X: =393
                Y: =0
                ZIndex: =16

            TextCanvas9_15 As Text:
                DisplayMode: =DisplayMode.Edit
                Height: =32
                Size: =12
                Text: ="Dependência Observações"
                Weight: ='TextCanvas.Weight'.Semibold
                Width: =198
                X: =395
                Y: =116
                ZIndex: =17

        AddDependenciaBTN_2 As groupContainer:
            Height: =40
            Visible: |-
                =(
                    Value('4Horas_2'.Text) = 4 Or
                    Value('24Horas_2'.Text) = 4 Or
                    Value('48Horas_2'.Text) = 4 Or
                    Value('1Semana_2'.Text) = 4 Or
                    Value('2Semanas_2'.Text) = 4 Or
                    Value('1Mes_2'.Text) = 4
                )
                And
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Dependências"))
                And
                If(formMode = 2, false,true)
            Width: =198
            X: =731
            Y: =655
            ZIndex: =21

            DynamicBtn_17 As DynamicBtn:
                BtnText: ="Adic. Depend."
                BtnWidth: =200
                Height: =40
                Visible: =true
                Width: =201
                ZIndex: =1

            "'Add dependencia_2' As button":
                AutoDisableOnSelect: =false
                BorderColor: =Color.Transparent
                DisabledBorderColor: =Color.Transparent
                DisabledFill: =Color.Transparent
                Fill: =Color.Transparent
                HoverBorderColor: =Color.Transparent
                HoverFill: =Color.Transparent
                OnSelect: |-
                    =Collect(collectDependencias, {row: Last(collectDependencias).row + 1})
                PressedFill: =Color.Transparent
                Size: =13
                Text: =""
                Width: =201
                ZIndex: =2

    Modal_2 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =26

        ModalConfirmation_5 As ModalConfirmation:
            ModalIcon: =Icon.Warning
            ModalIconColor: =cores.amareloMontepio
            ModalText: ="Deseja submeter os dados do Processo?"
            Visible: =ModalForm.visible
            ZIndex: =37

        BtnModalConfirm_4 As button:
            Color: =Color.Transparent
            Fill: =Color.Transparent
            HoverColor: =Color.Transparent
            HoverFill: =Color.Transparent
            OnSelect: |+
                =
                // Submeter Caracterização do Processo
                SubmitForm('Caracterizacao do Processo_2');
                If(formMode=1, ForAll(glr_Atividades_4.AllItems, Patch('Atividade/Processos',Defaults('Atividade/Processos'),{Atividade:Label12_4.Text,ID_Processo:'Caracterizacao do Processo_2'.LastSubmit.ID_Total,ID_PRO:LookUp(Atividades,ID_Total='Caracterizacao do Processo_2'.LastSubmit.ID_Total) })),If(formMode=0,RemoveIf(
                    'Atividade/Processos',
                   CountRows(Filter(RemoveAtividades,ID= 'Atividade/Processo')
                )>=1);
                ForAll(Colnovasatividades,
                Patch('Atividade/Processos',Defaults('Atividade/Processos'),{Atividade:ThisRecord.Atividade,ID_PRO:LookUp(Atividades,ID='Gallery Data_6'.Selected.ID)}))));
                
                Clear(RemoveAtividades);
                Clear(Colnovasatividades);
                
                Set(
                    LastAtividadeId,
                    'Caracterizacao do Processo_2'.LastSubmit.ID
                    //1005
                );
                
                    // Submeter Criticidade do Processo
                    ForAll(
                        Gallery2_2.AllItems,
                            Patch(
                                'Fatores de Criticidades',
                                If(
                                    formMode = FormMode.Edit,
                                    With(
                                        {record : ThisRecord.Label3_2.Text},
                                        LookUp(
                                            'Fatores de Criticidades',
                                            ThisRecord.ID = record
                                        )
                                    ),
                                    Defaults('Fatores de Criticidades')
                                ),
                                {
                                    'Tipo de Fator': ThisRecord.Dropdown2_2.Selected.Value,
                                    'quatro horas': Value(ThisRecord.'4horas_2'.Text),
                                    'vinte quatro horas': ThisRecord.'24horas_2'.Text,
                                    'quarenta oito horas': Value(ThisRecord.'48horas_2'.Text),
                                    'uma semana': Value(ThisRecord.'1semana_2'.Text),
                                    'duas semanas': Value(ThisRecord.'2semanas_2'.Text),
                                    'um mes': Value(ThisRecord.'1mes_2'.Text),
                                    'ID Atividade': LookUp(
                                        Atividades,
                                        ThisRecord.ID = LastAtividadeId
                                    ),
                                    Racional: ThisRecord.racional_2.Text
                                }
                            )
                    );
                    
                    // Submeter RTO
                    Patch(
                            RTOS,
                            If(
                                    formMode = FormMode.Edit,
                                    LookUp(
                                        RTOS,
                                        ThisRecord.ID = Label8_2.Text
                                    ),
                                    Defaults(RTOS)
                                ),
                            {
                                Atividade: LookUp(
                                    Atividades,
                                    ThisRecord.ID = LastAtividadeId
                                ),
                                Classificação: 'RTO label_2'.Text
                            }
                        );
                    
                    If(
                        Value('4Horas_2'.Text) = 4 Or Value('24Horas_2'.Text) = 4 Or Value('48Horas_2'.Text) = 4 Or Value('1Semana_2'.Text) = 4 Or Value('2Semanas_2'.Text) = 4 Or Value('1Mes_2'.Text) = 4,
                    
                        // Submeter Recursos
                        ForAll(
                            'Caracterização dos recursos_2'.AllItems,
                                Patch(
                                    Pessoas,
                                    If(
                                        formMode = FormMode.Edit,
                                        With(
                                            {record : ThisRecord.Label6_2.Text},
                                            LookUp(
                                                Pessoas,
                                                ThisRecord.ID = record
                                            )
                                        ),
                                        Defaults(Pessoas)
                                    ),
                                    {
                                        'Nº Empregado': ThisRecord.NumEmpregado_2.Text,
                                        'Colaborador Crítico': ThisRecord.Critico_4.Text,
                                        Teletrabalho: ThisRecord.Teletrabalho_2.Selected.Value,
                                        Tipo: ThisRecord.Tipo_2.Selected,
                                        Duração: ThisRecord.Duracao_2.Selected.Value,
                                        Observações: ThisRecord.Critico_5.Text,
                                        'ID Atividade': LookUp(
                                            Atividades,
                                            ThisRecord.ID = LastAtividadeId
                                        )
                                    }
                                )
                        );
                        
                        // Submeter Equipamentos
                        ForAll(
                            'Caracterização dos equipamentos_2'.AllItems,
                                Patch(
                                    'Equipamentos de Escritório',
                                    If(
                                        formMode = FormMode.Edit,
                                        With(
                                            {record : ThisRecord.Label9_6.Text},
                                            LookUp(
                                                'Equipamentos de Escritório',
                                                ThisRecord.ID = record
                                            )
                                        ),
                                        Defaults('Equipamentos de Escritório')
                                    ),
                                    {
                                        Equipamento: ThisRecord.Equipamento_2.Selected,
                                        Duração: ThisRecord.'Equipamento Duracao_2'.Selected.Value,
                                        Observações: ThisRecord.'Equipamento Obs_2'.Text,
                                        'ID Atividade': LookUp(
                                            Atividades,
                                            ThisRecord.ID = LastAtividadeId
                                        )
                                    }
                                )
                        );
                        
                        // Submeter Sistemas/Aplicações
                        ForAll(
                            'Caracterização dos sistemas_2'.AllItems,
                                Patch(
                                    Sistemas,
                                    If(
                                        formMode = FormMode.Edit,
                                        With(
                                            {record : ThisRecord.Label9_7.Text},
                                            LookUp(
                                                Sistemas,
                                                ThisRecord.ID = record
                                            )
                                        ),
                                        Defaults(Sistemas)
                                    ),
                                    {
                                        'Sistemas/Aplicações': ThisRecord.Sistema_2.Selected,
                                        Duração: ThisRecord.'Sistemas Duracao_2'.Selected.Value,
                                        Descrição: ThisRecord.'Sistemas Descrição_2'.Text,
                                        Observações: ThisRecord.'Sistemas Obs_2'.Text,
                                        'ID Atividade': LookUp(
                                            Atividades,
                                            ThisRecord.ID = LastAtividadeId
                                        )
                                    }
                                )
                        );
                        
                        // Submeter Dependências
                        ForAll(
                            'Caracterização das dependencias_2'.AllItems,
                                Patch(
                                    Dependências,
                                    If(
                                        formMode = FormMode.Edit,
                                        With(
                                            {record : ThisRecord.Label9_8.Text},
                                            LookUp(
                                                Dependências,
                                                ThisRecord.ID = record
                                            )
                                        ),
                                        Defaults(Dependências)
                                    ),
                                    {
                                        Entidades: ThisRecord.'Dependencias Entidades_2'.Selected,
                                        Importância: ThisRecord.'Dependencias Importancia_2'.Selected.Value,
                                        'Tipo de Dependência': ThisRecord.'Dependencias Tipo_2'.Selected.Value,
                                        'Unidade Orgânica': ThisRecord.'Dependencias UO_2'.Selected,
                                        'Informação de Suporte': ThisRecord.'Dependencias Informacao_2'.Text,
                                        Observações: ThisRecord.'Dependencias Observacoes_2'.Text,
                                        'ID Atividade': LookUp(
                                            Atividades,
                                            ThisRecord.ID = LastAtividadeId
                                        )
                                    }
                                )
                        )
                    );
                
                If(
                    IsEmpty(Errors('Fatores de Criticidades'))
                    And
                    IsEmpty(Errors(RTOS))
                    And
                    IsEmpty(Errors(Pessoas))
                    And
                    IsEmpty(Errors(Equipamentos))
                    And
                    IsEmpty(Errors('Sistemas/Aplicações'))
                    And
                    IsEmpty(Errors(Dependências)),
                
                    //em caso de sucesso
                    Patch(
                        'Histórico de aprovações',
                        Defaults('Histórico de aprovações'),
                        {
                            Estado:
                                LookUp(
                                    Atividades,
                                    ThisRecord.ID = LastAtividadeId
                                ).Estado,
                            'ID Atividade':
                                LookUp(
                                    Atividades,
                                    ThisRecord.ID = LastAtividadeId
                                )
                        }
                    );
                    Notify("Dados submetidos com sucesso!", NotificationType.Success, 4000);
                    Concurrent(
                        UpdateContext({ RTO: 0, RTOTempo: "<24 horas" }),
                        ResetForm('Caracterizacao do Processo_2');
                        ClearCollect(collectRecursos, Blank());
                        ClearCollect(collectEquipamentos, Blank());
                        ClearCollect(collectDependencias, Blank());
                        ClearCollect(collectSistemas, Blank())
                    );
                    Back(),
                    
                    Notify(
                        Concat(Errors('Fatores de Criticidades'), Column&": "&Message) & "
                            " & Concat(Errors(RTOS), Column&": "&Message) & "
                            " & Concat(Errors(Pessoas), Column&": "&Message) & "
                            " & Concat(Errors(Equipamentos), Column&": "&Message) & "
                            " & Concat(Errors('Sistemas/Aplicações'), Column&": "&Message) & "
                            " & Concat(Errors(Dependências), Column&": "&Message)
                        ,
                        NotificationType.Success,
                        4000
                    )
                )
                
                
            PressedColor: =Color.Transparent
            PressedFill: =Color.Transparent
            Text: =""
            Visible: =ModalForm.visible
            Width: =164
            X: =486
            Y: =440
            ZIndex: =38

        BtnModalCancel_5 As button:
            Color: =Color.Transparent
            Fill: =Color.Transparent
            HoverColor: =Color.Transparent
            HoverFill: =Color.Transparent
            OnSelect: |-
                =UpdateContext({
                    ModalForm: {visible: false}
                })
            PressedColor: =Color.Transparent
            PressedFill: =Color.Transparent
            Text: =""
            Visible: =ModalForm.visible
            Width: =164
            X: =718
            Y: =440
            ZIndex: =39

    glr_Atividades_4 As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =270
        Items: =collectatividades
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =51
        Visible: |-
            =//If(formMode=1 || formMode=0 && Trim(Lower('Passos do Registo de Atividade_1'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false)
            If(formMode=1 ,If( Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false))
        Width: =676
        X: =690
        Y: =480
        ZIndex: =28

        Label12_4 As label:
            Height: =33
            OnSelect: =Select(Parent)
            Text: =ThisItem.Atividade
            Width: =541
            X: =68
            Y: =11
            ZIndex: =1

        "'Equipamentos Remove_5' As icon.Add":
            Color: =cores.cinzento
            Height: =30
            Icon: =Icon.Trash
            OnSelect: |-
                =Select(Parent);
                RemoveIf(
                    collectatividades,
                    ThisRecord.Atividade=ThisItem.Atividade
                )
            Visible: =If(IsEmpty(collectatividades),false,true)
            Width: =30
            X: =38
            Y: =11
            ZIndex: =2

    inp_atividade_2 As text:
        BorderColor: =RGBA(0, 0, 0, 1)
        BorderThickness: =1
        Default: =""
        HintText: ="Atividade"
        RadiusBottomLeft: =0
        RadiusBottomRight: =0
        RadiusTopLeft: =0
        RadiusTopRight: =0
        Visible: |-
            =//If(formMode=1 || formMode=0 && Trim(Lower('Passos do Registo de Atividade_1'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false)
            If(formMode=1 ,If( Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false))
        Width: =490
        X: =718
        Y: =432
        ZIndex: =29

    Icon5_2 As icon.Add:
        Color: =RGBA(0, 0, 0, 1)
        Height: =36
        Icon: =Icon.Add
        OnSelect: |-
            =Collect(collectatividades, {Atividade: inp_atividade_2.Text});
            Reset(inp_atividade_2)
        Visible: |-
            =//If(formMode=1 || formMode=0 && Trim(Lower('Passos do Registo de Atividade_1'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false)
            If(formMode=1 ,If( Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false))
        Width: =46
        X: =1208
        Y: =436
        ZIndex: =30

    AproveReject_2 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =30

        ApproveBtn_2 As DynamicBtn:
            BtnText: ="Aprovar"
            BtnWidth: =200
            ButtonIcon: =Icon.Check
            Height: =40
            Visible: |-
                =(AtividadeRecord.Estado = 'Estado Processo'.'Em validação' Or AtividadeRecord.Estado = 'Estado Processo'.'Em revalidação') And currentUser = "DRI"
                And
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo"))
            Width: =201
            X: =913
            Y: =695
            ZIndex: =24

        ApproveBtnCode_2 As button:
            Color: =Color.Transparent
            Fill: =Color.Transparent
            HoverColor: =Color.Transparent
            HoverFill: =Color.Transparent
            OnSelect: |
                =UpdateContext(
                    {
                        ApproveForm: {
                            visible: true,
                            texto: "Deseja APROVAR a atividade ?"
                        }
                    }
                )
            PressedColor: =Color.Transparent
            PressedFill: =Color.Transparent
            Text: ="Aprovar"
            Visible: |-
                =(AtividadeRecord.Estado = 'Estado Processo'.'Em validação' Or AtividadeRecord.Estado = 'Estado Processo'.'Em revalidação') And currentUser = "DRI"
                And
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo"))
            Width: =201
            X: =904
            Y: =695
            ZIndex: =25

        RejectBtn_2 As DynamicBtn:
            BtnText: ="Rejeitar"
            BtnWidth: =200
            ButtonIcon: =Icon.Cancel
            Height: =40
            Visible: |-
                =(AtividadeRecord.Estado = 'Estado Processo'.'Em validação' Or AtividadeRecord.Estado = 'Estado Processo'.'Em revalidação') And currentUser = "DRI"
                And
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo"))
            Width: =201
            X: =1126
            Y: =695
            ZIndex: =26

        RejectBtnCode_2 As button:
            Color: =Color.Transparent
            Fill: =Color.Transparent
            HoverColor: =Color.Transparent
            HoverFill: =Color.Transparent
            OnSelect: |-
                =UpdateContext({
                    ApproveForm: {
                        visible: true,
                        texto: "Deseja REJEITAR a atividade ?"
                    }
                });
            PressedColor: =Color.Transparent
            PressedFill: =Color.Transparent
            Text: ="Rejeitar"
            Visible: |-
                =(AtividadeRecord.Estado = 'Estado Processo'.'Em validação' Or AtividadeRecord.Estado = 'Estado Processo'.'Em revalidação') And currentUser = "DRI"
                And
                Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo"))
            Width: =201
            X: =1126
            Y: =695
            ZIndex: =27

    Label13_1 As label:
        FontWeight: =FontWeight.Bold
        Text: ="Atividades"
        Visible: =If( Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false)
        X: =723
        Y: =392
        ZIndex: =31

    Label15 As label:
        Text: =formMode
        X: =732
        Y: =13
        ZIndex: =32

    glr_Atividades_5 As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =270
        Items: =Filter('Atividade/Processos',ID_PRO.ID='Gallery Data_6'.Selected.ID)
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =41
        Visible: =If(formMode=2 && Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false)
        X: =705
        Y: =436
        ZIndex: =33

        Label12_5 As label:
            Height: =35
            OnSelect: =Select(Parent)
            Text: =ThisItem.Atividade
            Width: =365
            X: =23
            Y: =5
            ZIndex: =1

        Label16 As label:
            OnSelect: =Select(Parent)
            Text: ="-"
            Width: =15
            X: =8
            ZIndex: =2

    ApproveModal_2 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =33

        ModalConfirmation_6 As ModalConfirmation:
            Height: =768
            ModalIcon: =Icon.Warning
            ModalIconColor: =cores.amareloMontepio
            ModalText: =ApproveForm.texto
            Visible: |-
                =If(
                    ApproveForm.visible,
                    true,
                    false
                )
            Width: =1366
            ZIndex: =40

        BtnModalConfirm_5 As button:
            Color: =Color.Transparent
            Fill: =Color.Transparent
            HoverColor: =Color.Transparent
            HoverFill: =Color.Transparent
            OnSelect: |-
                =If(
                    Trim(Lower("Aprovar")) in Trim(Lower(ApproveForm.texto)),
                
                    //Escrever no Histórico de Aprovações - APROVADO
                    Patch(
                        'Histórico de aprovações',
                        Defaults('Histórico de aprovações'),
                        {
                            Estado:'Estado Processo'.Aprovado,
                            'ID Atividade':
                                LookUp(
                                    Atividades,
                                    ThisRecord.ID = 'Gallery Data_6'.Selected.ID
                                ),
                            'ID_Total': 
                               LookUp(
                                    Atividades,
                                    ThisRecord.ID_Total = 'Gallery Data_6'.Selected.ID_Total
                                ),
                            Decisor: User().FullName,
                            'Data Aprovaçao': DateTimeValue(Text(Now(), "dd/mm/yyyy"))
                        }
                    );
                    //Atualizar o estado da Atividade - APROVADO
                    Patch(
                        Atividades,
                        LookUp(
                            Atividades,
                            ThisRecord.ID = 'Gallery Data_6'.Selected.ID
                        ),
                        {
                            Estado:'Estado Processo'.Aprovado
                        }
                    );
                    'GCN-Respostaaopedido'.Run(
                        'Gallery Data_6'.Selected.Atividade,
                        User().Email,
                        "APROVADO"
                    );
                    Back();
                    Notify("Atividade " & 'Gallery Data_6'.Selected.Atividade & " aprovada!", NotificationType.Success, 4000),
                
                    //Escrever no Histórico de Aprovações - REJEITADO
                    Patch(
                        'Histórico de aprovações',
                        Defaults('Histórico de aprovações'),
                        {
                            Estado:'Estado Processo'.Rejeitado,
                            'ID Atividade':
                                LookUp(
                                    Atividades,
                                    ThisRecord.ID = 'Gallery Data_6'.Selected.ID
                                ),
                            'ID_Total': 
                               LookUp(
                                    Atividades,
                                    ThisRecord.ID_Total = 'Gallery Data_6'.Selected.ID_Total
                                ),
                            Decisor: User().FullName,
                            'Data Aprovaçao': DateValue(Text(Now(), "dd/mm/yyyy"))
                        }
                    );
                    //Atualizar o estado da Atividade - Rejeitado
                    Patch(
                        Atividades,
                        LookUp(
                            Atividades,
                            ThisRecord.ID = 'Gallery Data_6'.Selected.ID
                        ),
                        {
                            Estado:'Estado Processo'.Rejeitado
                        }
                    );
                    'GCN-Respostaaopedido'.Run(
                        'Gallery Data_6'.Selected.Atividade,
                        User().Email,
                        "REJEITADO"
                    );
                    Back();
                    Notify("Atividade " & 'Gallery Data_6'.Selected.Atividade & " rejeitada!", NotificationType.Success, 4000)
                )
            PressedColor: =Color.Transparent
            PressedFill: =Color.Transparent
            Text: =""
            Visible: =ApproveForm.visible
            Width: =164
            X: =488
            Y: =440
            ZIndex: =41

        BtnModalCancel_4 As button:
            Color: =Color.Transparent
            Fill: =Color.Transparent
            HoverColor: =Color.Transparent
            HoverFill: =Color.Transparent
            OnSelect: |-
                =UpdateContext({
                    ApproveForm: {visible: false}
                })
            PressedColor: =Color.Transparent
            PressedFill: =Color.Transparent
            Text: =""
            Visible: =ApproveForm.visible
            Width: =164
            X: =716
            Y: =440
            ZIndex: =42

    glr_Atividades_6 As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =270
        Items: =ColAtividades
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =37
        Visible: =If(formMode=0 && Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false)
        X: =710
        Y: =480
        ZIndex: =34

        Label12_6 As label:
            Height: =35
            OnSelect: =Select(Parent)
            Text: =ThisItem.Atividade
            Width: =365
            X: =32
            ZIndex: =1

        "'Equipamentos Remove_7' As icon.Add":
            Color: =cores.cinzento
            Height: =30
            Icon: =Icon.Trash
            OnSelect: |-
                =Select(Parent);
                Collect(RemoveAtividades,{ID: ThisItem.'Atividade/Processo'});
                RemoveIf(
                    ColAtividades,
                    ThisRecord.Atividade=ThisItem.Atividade
                )
            Width: =30
            X: =567
            Y: =5
            ZIndex: =2

        Label18 As label:
            Height: =33
            OnSelect: =Select(Parent)
            Text: ="-"
            Width: =13
            X: =19
            ZIndex: =3

    inp_atividade_4 As text:
        BorderColor: =RGBA(0, 0, 0, 1)
        Default: =""
        HintText: ="Atividades"
        RadiusBottomLeft: =0
        RadiusBottomRight: =0
        RadiusTopLeft: =0
        RadiusTopRight: =0
        Visible: =If(formMode=0 && Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false)
        Width: =490
        X: =723
        Y: =432
        ZIndex: =35

    Icon5_4 As icon.Add:
        Height: =36
        Icon: =Icon.Add
        OnSelect: |-
            =Collect(ColAtividades, {Atividade: inp_atividade_4.Text});
            Collect(Colnovasatividades,{Atividade: inp_atividade_4.Text,ID_PROCol:LookUp('Atividade/Processos',ID_PRO.ID='Gallery Data_6'.Selected.ID)})
        Visible: =If(formMode=0 && Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Caracterização do Processo")),true,false)
        Width: =46
        X: =1231
        Y: =436
        ZIndex: =36

    FatoresHeaders_2 As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =51

        Label3_19 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Text: ="<4 horas"
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =110
            X: =434
            Y: =160
            ZIndex: =4

        Label3_20 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Text: ="<24 horas"
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =110
            X: =544
            Y: =160
            ZIndex: =5

        Label3_21 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Text: ="<48 horas"
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =110
            X: =654
            Y: =160
            ZIndex: =6

        Label3_22 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Text: ="<1 semana"
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =110
            X: =764
            Y: =160
            ZIndex: =7

        Label3_23 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Text: ="<2 semanas"
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =110
            X: =874
            Y: =160
            ZIndex: =8

        Label3_24 As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Text: ="<1 mês"
            Visible: =Trim(Lower('Passos do Registo de Atividade_2'.Selected.titulo)) = Trim(Lower("Fatores de Criticidade"))
            Width: =110
            X: =984
            Y: =160
            ZIndex: =9

